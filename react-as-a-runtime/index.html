<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/blogs/styles.880f289990939c4ad11f.css">body{--blue:#007acc;--pink:#ffa7c4;--bg:#fff;--header:var(--blue);--textNormal:#222;--textTitle:#222;--textLink:var(--blue);--hr:rgba(0,0,0,0.2);--inlineCode-bg:rgba(255,229,100,0.2);--inlineCode-text:#1a1a1a;background-color:var(--bg);transition:color .3s ease-out,background .3s ease-out}body.dark{-webkit-font-smoothing:antialiased;--bg:#282c35;--header:#fff;--textNormal:hsla(0,0%,100%,0.88);--textTitle:#fff;--textLink:var(--pink);--hr:hsla(0,0%,100%,0.2);--inlineCode-bg:#373c49;--inlineCode-text:#e6e6e6}em,h1,h2,h3,h4,h5,h6,li,p,small,strong{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}blockquote{margin:20px -30px 30px;padding:20px 45px 20px 26px}body:not(.dark) blockquote{background-color:rgba(255,229,100,.3);border-left:9px solid #ffe564}blockquote p:first-of-type:not(:last-child){font-weight:700;color:initial;margin-top:0}blockquote p:nth-of-type(2){margin-top:0;font-size:17px}code[class*=language-],pre[class*=language-]{color:#fff;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace}:not(pre)>code[class*=language-],pre[class*=language-]{background:#011627}pre[class*=language-]{border-radius:10px}pre[class*=language-]::selection{background:#27292a}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:hsla(0,0%,93%,.15)}:not(pre)>code[class=language-text]{border-radius:.3em;background-color:var(--inlineCode-bg)!important;color:var(--inlineCode-text);white-space:normal;padding:0 3px;word-break:break-word;font-family:Menlo,Consolas,Courier New,monospace;text-shadow:none}pre[data-line]{padding:1em 0 1em 3em;position:relative}.gatsby-highlight-code-line{background-color:#022a4b;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #ffa7c4}.gatsby-highlight{overflow:auto}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%}.token.attr-name{color:#addb67;font-style:italic}.token.comment{color:#637777}.token.string,.token.url{color:#addb67}.token.variable{color:#d6deeb}.token.number{color:#f78c6c}.token.builtin,.token.char,.token.constant,.token.function{color:#82aaff}.token.punctuation{color:#c792ea}.token.doctype,.token.selector{color:#c792ea;font-style:"italic"}.token.class-name{color:#ffcb8b}.token.keyword,.token.operator,.token.tag{color:#ffa7c4}.token.boolean{color:#ff5874}.token.property{color:#80cbc4}.token.namespace{color:#b2ccd6}nav>ol{list-style:none;margin-left:0}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.react-toggle{touch-action:pan-x;display:inline-block;position:relative;cursor:pointer;background-color:transparent;border:0;padding:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.react-toggle-screenreader-only{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle-track{width:50px;height:24px;padding:0;border-radius:30px;background-color:#0f1114;transition:all .3s ease;display:-webkit-flex;display:flex}.react-toggle-track-check{-webkit-flex:1 1;flex:1 1;opacity:0;transition:opacity .25s ease;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{-webkit-flex:1 1;flex:1 1;display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{position:absolute;top:1px;left:1px;width:22px;height:22px;border-radius:50%;background-color:#fafafa;box-sizing:border-box;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms}.react-toggle--checked .react-toggle-thumb{left:27px;border-color:#19ab27}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #ffa7c4}.react-toggle:active .react-toggle-thumb{box-shadow:0 0 5px 5px #ffa7c4}</style><meta name="generator" content="Gatsby 2.3.14"/><link rel="manifest" href="/blogs/manifest.webmanifest"/><meta name="theme-color" content="#ffffff"/><link rel="apple-touch-icon" sizes="48x48" href="/blogs/icons/icon-48x48.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="72x72" href="/blogs/icons/icon-72x72.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="96x96" href="/blogs/icons/icon-96x96.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="144x144" href="/blogs/icons/icon-144x144.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="192x192" href="/blogs/icons/icon-192x192.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="256x256" href="/blogs/icons/icon-256x256.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="384x384" href="/blogs/icons/icon-384x384.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><link rel="apple-touch-icon" sizes="512x512" href="/blogs/icons/icon-512x512.png?v=510a6cbfad83784ff2ce78ff5460446634c9080f"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/blogs/rss.xml"/><title data-react-helmet="true"></title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:inherit;font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);border-left-color:inherit;opacity:0.8;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:var(--hr);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"â€” ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:var(--textLink);text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}a.anchor{box-shadow:none;}a.anchor svg[aria-hidden="true"]{stroke:var(--textLink);}p code{font-size:1rem;}h1 code, h2 code, h3 code, h4 code, h5 code, h6 code{font-size:inherit;}li code{font-size:1rem;}blockquote.translation{font-size:1em;}</style><link as="script" rel="preload" href="/blogs/webpack-runtime-60b6eddc7b2f69aba7f0.js"/><link as="script" rel="preload" href="/blogs/app-28a14a3989973cffb8ca.js"/><link as="script" rel="preload" href="/blogs/styles-593a6e91d2f8e7c9e0e3.js"/><link as="script" rel="preload" href="/blogs/component---src-templates-blog-post-js-e32bf5f6d150edd53e26.js"/><link as="fetch" rel="preload" href="/blogs/static/d/699/path---react-as-a-runtime-0-a-9-d57-nXsEH9seJGbH7iwlPjEdzgRoN3k.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><section class="sc-bdVaJa lwKmQ"><div class="sc-bxivhb UPEQT"><header class="sc-EHOje izLLQu"><h3 style="font-family:sans-serif;margin-top:0;margin-bottom:-1.75rem"><a class="sc-ifAKCX bUKbYi" href="/blogs/">ğŸ˜</a></h3><div class="react-toggle"><div class="react-toggle-track"><div class="react-toggle-track-check"><span>ğŸŒš</span></div><div class="react-toggle-track-x"><span>ğŸŒ</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between Dark and Light mode"/></div></header><hgroup><h1 style="color:var(--textTitle);transition:color 0.3s ease-out, background 0.3s ease-out">React as a UI Runtime</h1><time style="font-size:0.83255rem;line-height:1.75rem;display:block;margin-bottom:1.75rem;margin-top:-1.75rem">2019/02/02</time></hgroup><main style="font-size:1.225rem"><p>ç¿»è¯‘è‡ª Dan çš„<a href="https://overreacted.io/react-as-a-ui-runtime/">åšå®¢</a>ã€‚æ–‡ç« å¾ˆé•¿:)</p>
<p>è®¸å¤šæ•™ç¨‹ä¸­æåˆ° React æ˜¯ä¸€ä¸ª UI åº“ï¼Œè¿™è¯´å¾—æ²¡ä»€ä¹ˆé—®é¢˜ã€‚å°±åƒå­—é¢ä¸Šä¸€æ ·ï¼Œå®ƒç¡®å®æ˜¯ä¸€ä¸ª UI åº“ï¼
<a
    class="gatsby-resp-image-link"
    href="/blogs/static/0429fcb4a2f2022852afc698ff8968f1/d19c0/react.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 500px;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 29.2%; position: relative; bottom: 0; left: 0; background-image: url('data:image/svg+xml,%3csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'117\'%3e%3cpath d=\'M0 59v58h401V0H0v59m150-21v13h3c2 0 3-1 3-5 0-7 3-7 6 0 2 3 3 5 5 5 4 0 4-1 1-6l-2-4 2-3c3-3 3-8 0-11-3-2-4-2-10-2h-8v13m86-9l-1 2c-2 1-2 4 0 5l1 6c0 6 2 9 7 9 2 0 3-4 1-5-2 0-2-2-2-5s0-5 2-5l1-3-1-2-2-2c0-2-1-2-3-2s-3 0-3 2m-60 5c-3 3-4 10-2 13 4 5 11 5 15 1 3-3 2-4-4-2h-5c-4-3-2-4 5-4 6 0 6 0 6-3s-5-8-9-8l-6 3m20 0c-2 2-2 2 0 3l4-1h4c3 2 2 3-2 3-7 0-11 7-6 11h10l3 1c2 0 2 0 2-8 0-7 0-8-3-10-3-3-8-3-12 1m21 0c-6 6-2 17 6 17 4 0 9-4 9-6 0-3-4-2-6 0-3 4-9-1-6-7 1-3 4-4 6-1 2 2 6 3 6 0l-2-4c-4-3-9-3-13 1\' fill=\'%23d3d3d3\' fill-rule=\'evenodd\'/%3e%3c/svg%3e'); background-size: cover; display: block;"
    ></span>
    <picture>
        <source
          data-srcset="/blogs/static/0429fcb4a2f2022852afc698ff8968f1/f2fbe/react.webp 200w,
/blogs/static/0429fcb4a2f2022852afc698ff8968f1/e227a/react.webp 400w,
/blogs/static/0429fcb4a2f2022852afc698ff8968f1/0ca0c/react.webp 500w"
          sizes="(max-width: 500px) 100vw, 500px"
          type="image/webp"
        />
        <source
          srcset="/blogs/static/0429fcb4a2f2022852afc698ff8968f1/9ec3c/react.png 200w,
/blogs/static/0429fcb4a2f2022852afc698ff8968f1/c7805/react.png 400w,
/blogs/static/0429fcb4a2f2022852afc698ff8968f1/d19c0/react.png 500w"
          sizes="(max-width: 500px) 100vw, 500px"
          type="image/png"
        />
        <img
          class="gatsby-resp-image-image lazyload"
          style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;"
          data-src="/blogs/static/0429fcb4a2f2022852afc698ff8968f1/d19c0/react.png"
          alt="React homepage screenshot: "A JavaScript library for building user interfaces""
          title=""
        />
      </picture>
  </span>
  </a></p>
<p>æˆ‘ä¹‹å‰å†™è¿‡å…³äºåˆ›å»º <a href="/blogs/the-elements-of-ui-engineering/">UI</a> æ‰€é‡åˆ°çš„æŒ‘æˆ˜ï¼Œä½†æ˜¯è¿™ç¯‡åšå®¢å°†é‡‡ç”¨ä¸€ä¸ªä¸åŒçš„æ–¹å¼çš„æ¥è®¨è®º Reactâ€”æ›´æ¥è¿‘ <a href="https://en.wikipedia.org/wiki/Runtime_system">programming runtime</a></p>
<p><strong>è¿™ç¯‡æ–‡ç« ä¸ä¼šæ•™ä½ æ€ä¹ˆä½¿ç”¨ React æ¥åˆ›å»º UIï¼Œ</strong>å¦‚æœä½ å¯¹ React çš„ç¼–ç¨‹æ–¹å¼æœ‰äº†æ›´ä¸ºæ·±å…¥çš„ç†è§£åï¼Œè¿™ç¯‡æ–‡ç« å¯èƒ½å¸®åˆ°ä½ ã€‚</p>
<hr>
<p><strong>æ³¨æ„ï¼šå¦‚æœä½ æ­£åœ¨å­¦ä¹  Reactï¼Œæœ€å¥½å…ˆçœ‹<a href="https://reactjs.org/docs/getting-started.html#learn-react">æ–‡æ¡£</a></strong></p>
<p><font size="60">âš ï¸</font></p>
<p><em>è¿™æ˜¯ä¸€ç¯‡æ·±åº¦æ–‡ç« ï¼Œè€Œä¸æ˜¯ä¸€ç¯‡æ–°äººå‘æ•™ç¨‹ï¼</em>åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šä»é¦–è¦åŸåˆ™æ¥æè¿°å¤§éƒ¨åˆ†çš„ React ç»†èŠ‚ã€‚æˆ‘ä¸ä¼šè§£é‡Šæ€ä¹ˆä½¿ç”¨å®ƒä»¬â€”åªè¯´æ˜å®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<p>è¿™æ–‡ç« é¢å‘æœ‰ç»éªŒçš„å¼€å‘å’Œé‚£äº›è¿˜åœ¨æƒè¡¡æ˜¯å¦ä½¿ç”¨ React çš„å…¶ä»– UI åº“çš„ä½¿ç”¨è€…ã€‚æˆ‘å¸Œæœ›å®ƒèƒ½å¸®åŠ©åˆ°ä½ ä»¬ï¼</p>
<p><strong>å¾ˆå¤šå¼€å‘è€…å³ä½¿æ²¡æœ‰è€ƒè™‘è¿‡è¿™æ–¹é¢çš„é—®é¢˜ï¼Œä¹Ÿèˆ’èˆ’æœæœåœ°ä½¿ç”¨äº† React å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œ</strong> This is definitely a programmer-centric view of React rather than, say, a <a href="http://mrmrs.cc/writing/2016/04/21/developing-ui/">designer-centric one</a>. But I donâ€™t think it hurts to have resources for both.</p>
<p>çœ‹å®Œäº†å…è´£å£°æ˜ï¼Œèµ·é£ ğŸ›«ï¸ å§ï¼</p>
<p>ã€Œè¯‘è€…æ³¨ã€ï¼šç°åœ¨å¼€å§‹è¿›å…¥æ­£é¢˜ï¼Œæ ‡é¢˜å’Œä¸€äº›é€šç”¨æœ¯è¯­ä¸ç¿»è¯‘ã€‚</p>
<hr>
<h2 id="host-tree"><a href="#host-tree" aria-label="host tree permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Host Tree</h2>
<p>ä¸€éƒ¨åˆ†ç¨‹åºåå‡º(output)æ•°å­—ï¼Œä¸€äº›ç¨‹åºä¼šå†™è¯—ã€‚ä¸åŒçš„è¯­è¨€å’Œå®ƒä»¬çš„ runtimes é€šå¸¸ä¼šé’ˆå¯¹ä¸€äº›ç‰¹å®šçš„ç”¨ä¾‹è¿›è¡Œä¼˜åŒ–ï¼ŒReact ä¹Ÿä¸€æ ·ã€‚</p>
<p>React ç¨‹åºé€šå¸¸ä¼šå¾—åˆ°<strong>ä¸€é¢—éšæ—¶ä¼šæ”¹å˜çš„æ ‘</strong>ã€‚å®ƒå¯èƒ½æ˜¯ <a href="https://www.npmjs.com/package/react-dom">DOM æ ‘</a>ã€<a href="https://developer.apple.com/library/archive/documentation/General/Conceptual/Devpedia-CocoaApp/View%20Hierarchy.html">iOS å±‚çº§å›¾(iOS hierarchy)</a>ï¼Œ<a href="https://react-pdf.org/">PDF primitives</a>ï¼Œç”šè‡³ä¸€ä¸ª <a href="https://reactjs.org/docs/test-renderer.html">JSON</a> å¯¹è±¡ã€‚å¤§å¤šæ˜¯æ—¶å€™æˆ‘ä»¬éƒ½å¸Œæœ›å®ƒä¸ºæˆ‘ä»¬å±•ç¤º UIã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥ç§°å®ƒä¸º â€<em>host</em> treeâ€æ˜¯å› ä¸ºå®ƒå±äº <strong>å®¿ä¸»ç¯å¢ƒï¼ˆhost environmentï¼‰</strong> çš„ä¸€éƒ¨åˆ†â€”å°±åƒ DOM å’Œ iOSã€‚Host tree é€šå¸¸ä¼šæœ‰å®ƒä»¬<a href="https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild">è‡ªèº«</a><a href="https://developer.apple.com/documentation/uikit/uiview/1622616-addsubview">ç‰¹æœ‰</a>çš„å‘½ä»¤å¼ï¼ˆimperativeï¼‰ APIã€‚React is a layer on top of it.</p>
<p>æ‰€ä»¥ React æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼ŸæŠ½è±¡åœ°è¯´ï¼Œå®ƒå¸®åŠ©ä½ åœ¨å“åº”ä¸€äº›ç±»ä¼¼äºäº¤äº’ï¼Œç½‘ç»œå“åº”ï¼Œè®¡æ—¶å™¨ç­‰å¤–éƒ¨äº‹ä»¶æ—¶ï¼Œä¹Ÿèƒ½å¤Ÿå¯é¢„æµ‹åœ°ç®¡ç†è¿™å¤æ‚çš„ Host treeã€‚</p>
<p>å½“ä¸€ä¸ªä¸“ç”¨å·¥å…·å¯ä»¥é€šè¿‡æ–½åŠ ç‰¹å®šçš„çº¦æŸå¹¶ä»ä¸­è·ç›Šçš„æ—¶å€™ï¼Œå®ƒè¡¨ç°å¾—ä¼šæ¯”é€šç”¨çš„å·¥å…·è¦å¥½ã€‚React åœ¨ä¸¤ä¸ªåŸåˆ™ä¸Šåšäº†ä¸€ä¸ªèµŒæ³¨ï¼š</p>
<ul>
<li><strong>ç¨³å®šæ€§ã€‚</strong> Host tree ç›¸å¯¹ç¨³å®šï¼Œå¤§å¤šæ•°çš„æ›´æ–°éƒ½ä¸ä¼šä»æ ¹æœ¬ä¸Šæ”¹å˜å®ƒçš„æ•´ä½“ç»“æ„ã€‚ä¸€ä¸ª app æ¯ç§’éƒ½ä¼šé‡æ–°æ’åˆ—å®ƒæ‰€æœ‰çš„äº¤äº’å…ƒç´ çš„å·¥å…·æ˜¾ç„¶å¾ˆéš¾ä½¿ç”¨ï¼Œæˆ‘çš„ button å»å“ªäº†ï¼Ÿä¸ºä»€ä¹ˆæˆ‘çš„æ˜¾ç¤ºå±åœ¨ä¹±åŠ¨ï¼Ÿ</li>
<li><strong>è§„å¾‹æ€§ã€‚</strong> Host tree å¯ä»¥åˆ†è§£æˆå¤–è§‚å’Œè¡Œä¸ºä¸€è‡´çš„ UI æ¨¡å¼ï¼ˆæ¯”å¦‚æŒ‰é’® ğŸ”˜ï¼Œåˆ—è¡¨ï¼Œå¤´åƒ ğŸ‘¤ï¼‰è€Œä¸æ˜¯éšæœºçš„å½¢çŠ¶ã€‚</li>
</ul>
<p><strong>å¯¹äºå¤§å¤šæ•° UI æ¥è¯´è¿™äº›è¡Œä¸ºæ˜¯æ­£ç¡®çš„ã€‚</strong>ä½†æ˜¯å¦‚æœä½ éœ€è¦çš„ UI æ²¡æœ‰ç¨³å®šçš„è¾“å‡ºæ¨¡å¼æ—¶ï¼ŒReact å°±ä¸é€‚åˆäº†ã€‚æ¯”å¦‚ï¼ŒReact å¯ä»¥å¸®åŠ©ä½ å†™ä¸€ä¸ªç±»ä¼¼ Twitter å®¢æˆ·ç«¯çš„ç©æ„ï¼Œä½†æ˜¯å†™ä¸äº† <a href="https://www.youtube.com/watch?v=Uzx9ArZ7MUU">3D pipes screensaver</a></p>
<h2 id="host-instances"><a href="#host-instances" aria-label="host instances permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Host Instances</h2>
<p>Host tree ç”±å¤§é‡çš„ â€œhost instancesâ€ æ„æˆã€‚</p>
<p>åœ¨ DOM ç¯å¢ƒä¸­ï¼Œhost instances å¯ä»¥è®¤ä¸ºæ˜¯æ™®é€šçš„ DOM èŠ‚ç‚¹â€”å°±æ˜¯ä½ å¹³æ—¶è°ƒç”¨ <code class="language-text">document.createElement(&#39;div&#39;)</code> å¾—åˆ°çš„å¯¹è±¡ã€‚åœ¨ iOS ä¸­ï¼Œhost instances å°±æ˜¯é€šè¿‡ JS æ¥å”¯ä¸€æ ‡ç¤ºçš„ native viewã€‚</p>
<p>Host instances æ‹¥æœ‰è‡ªå·±çš„å±æ€§ï¼ˆ<code class="language-text">domNode.className</code> æˆ–è€… iOS ä¸­çš„ <code class="language-text">view.tintColor</code>)ã€‚å®ƒä»¬åŒæ ·ä¹ŸåŒ…å«äº†å…¶ä»– host instances ä½œä¸ºè‡ªå·±çš„å­èŠ‚ç‚¹ã€‚</p>
<p>ï¼ˆè¿™é‡Œå’Œ React æ²¡æœ‰ä»»ä½•å…³å¿ƒï¼Œæˆ‘ä»…ä»…åœ¨æè¿° Host environmentï¼‰</p>
<p>é€šå¸¸ä¼šæœ‰ä¸€ç³»åˆ— API ç”¨æ¥æ“ä½œ host instancesã€‚DOM å°±æä¾›äº†å¦‚åŒ <code class="language-text">appendChild</code>, <code class="language-text">removeChild</code>, <code class="language-text">setAttribute</code> ç­‰ç­‰æ–¹æ³•ã€‚è€Œåœ¨ React ä¸­ï¼Œä½ ä¸€èˆ¬ä¸ä¼šç›´æ¥å»æ‰ç”¨è¿™äº›æ–¹æ³•ã€‚React ä¼šå¸®ä½ åšå¥½å®ƒã€‚</p>
<h2 id="renderers"><a href="#renderers" aria-label="renderers permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Renderers</h2>
<p>ä¸€ä¸ª <em>æ¸²æŸ“å™¨ï¼ˆrendererï¼‰</em> ä¼šå‘Šè¯‰ React å¦‚ä½•å»å’Œ host environmentï¼ˆå®¿ä¸»ç¯å¢ƒï¼‰æ²Ÿé€šï¼Œå¹¶ç®¡ç†å®ƒçš„ host instancesã€‚React DOM, React Native, ç”šè‡³ <a href="https://mobile.twitter.com/vadimdemedes/status/1089344289102942211">Ink</a> éƒ½å±äº React çš„ renderersã€‚å…¶å®ä½ ä¹Ÿå¯ä»¥<a href="https://github.com/facebook/react/tree/master/packages/react-reconciler">å†™è‡ªå·±çš„ renderer</a>ã€‚</p>
<p>React renderers å¯ä»¥æ‹¥æœ‰ä¸¤ç§å·¥ä½œæ–¹å¼ã€‚</p>
<p>ç»å¤§å¤šæ•° renderers éƒ½æ˜¯é‡‡ç”¨ â€œmutatingâ€ çš„æ¨¡å¼æ¥ç¼–å†™çš„ã€‚è¿™ç§æ¨¡å¼æ­£æ˜¯ DOM çš„å·¥ä½œæ–¹å¼ï¼šå¯ä»¥ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¾ç½®å…¶å±æ€§ï¼Œå¹¶ä¸”ç»™å®ƒä»¬æ·»åŠ å­èŠ‚ç‚¹æˆ–è€…ç§»é™¤è¿™äº›å­èŠ‚ç‚¹ã€‚è¿™äº› host instances æ˜¯å®Œå…¨å¯å˜ï¼ˆmutableï¼‰çš„ã€‚</p>
<p>React ä¹Ÿå¯ä»¥åœ¨ â€persistentâ€ ä¸‹å·¥ä½œã€‚è¯¥æ¨¡å¼é€‚ç”¨äºä¸æä¾›è¯¸å¦‚ <code class="language-text">appendChild()</code> è¿™ç§ APIï¼Œè€Œæ˜¯é€šè¿‡æ›¿æ¢ top-level child å¹¶å¤åˆ¶çˆ¶èŠ‚ç‚¹æ ‘çš„å®¿ä¸»ç¯å¢ƒã€‚</p>
<p>é‡‡ç”¨ immutabilityï¼ˆä¸å¯å˜ï¼‰çš„ host tree è®©å¤šçº¿ç¨‹çš„å®ç°å˜å¾—å¾ˆç®€å•ã€‚<a href="https://facebook.github.io/react-native/blog/2018/06/14/state-of-react-native-2018">React Fabric</a> å°±å……åˆ†åˆ©ç”¨äº†è¿™ä¸€ç‚¹ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ª React ç”¨æˆ·ï¼Œä½ ä»æ¥éƒ½ä¸éœ€è¦å»è€ƒè™‘è¿™äº›æ¨¡å¼ã€‚æˆ‘åªæƒ³å¼ºè°ƒ React ä¸åªæ˜¯ä¸€ä¸ªå°† A è½¬åŒ–æˆ B çš„é€‚é…å™¨ï¼ˆadapterï¼‰ã€‚å¦‚æœä½ èƒ½äº†è§£ä¸€äº›åº•å±‚ API çš„è®¾è®¡èŒƒå¼è¿˜æ˜¯ä¼šå¾ˆæœ‰ç”¨çš„(orthogonal)ã€‚</p>
<h2 id="react-elements"><a href="#react-elements" aria-label="react elements permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React Elements</h2>
<p>åœ¨ host environmentï¼Œä¸€ä¸ª host instanceï¼ˆæ¯”å¦‚ DOM èŠ‚ç‚¹ï¼‰æ˜¯æœ€å°çš„å¯æ„å»ºå•å…ƒ(smallest building block)ã€‚åœ¨ React ä¸­ï¼Œæœ€å°çš„å¯æ„å»ºå•å…ƒå°±æ˜¯ <em>React Element</em>ã€‚</p>
<p>React Element å…¶å®æ˜¯çº¯ JS å¯¹è±¡ï¼Œå®ƒç”¨æ¥æè¿° host instanceã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// JSX is a syntax sugar for these objects.</span>
<span class="token comment">// &lt;button className="blue" /></span>
<span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>React element å¾ˆè½»é‡ï¼Œæ²¡æœ‰å’Œ host instance æ†ç»‘åœ¨ä¸€èµ·ã€‚å®ƒä»…ä»…æ˜¯ä½ åœ¨å±å¹•ä¸Šæ‰€çœ‹åˆ°çš„æ•ˆæœçš„<em>æè¿°</em>ã€‚</p>
<p>å’Œ host instances ä¸€æ ·ï¼ŒReact elements ä¹Ÿå¯ä»¥ç»„æˆæ ‘ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// å¦‚ä½ æ‰€è§ï¼ŒJSX å°±æ˜¯è¿™äº›å¯¹è±¡çš„è¯­æ³•ç³–ï¼Œä¹Ÿå°±æ˜¯ createElement</span>
<span class="token comment">// &lt;dialog></span>
<span class="token comment">//   &lt;button className="blue" /></span>
<span class="token comment">//   &lt;button className="red" /></span>
<span class="token comment">// &lt;/dialog></span>
<span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> <span class="token string">'dialog'</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'blue'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'button'</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span> className<span class="token punctuation">:</span> <span class="token string">'red'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>æ³¨æ„ï¼šæˆ‘åœ¨è¿™é‡Œåˆ é™¤äº†ä¸€äº›å’Œä¸‹é¢è§£é‡Š<a href="/blogs/why-do-react-elements-have-typeof-property/">æ²¡æœ‰å¤ªå¤šè”ç³»</a>çš„å±æ€§ã€‚</em></p>
<p>ç„¶è€Œè¦è®°ä½ï¼Œ<strong>React elements æ²¡æœ‰æ‰€è°“çš„ persistent identity</strong>ã€‚è¿™æ„å‘³ç€ï¼Œå®ƒä»¬åœ¨ä»»ä½•æ—¶å€™å‘ç”Ÿæ›´æ–°åªèƒ½ä¸¢å¼ƒå½“å‰çš„ elementï¼Œå¹¶é‡æ–°åˆ›å»ºï¼ˆè¯‘è€…æ³¨ï¼šæ³¨æ„è¿™é‡ŒæŒ‡çš„ React Elements ä¼šé‡æ–°ç”Ÿæˆï¼Œè€Œä¸æ˜¯å¯¹åº”çš„ DOM Elementsï¼Œè¿™åœ¨åæ–‡ä¼šç»§ç»­è§£é‡Šï¼‰ã€‚</p>
<p>React elements æ˜¯ä¸å¯å˜å¾—ï¼ˆimmutableï¼‰ã€‚æ¯”å¦‚ä½ ä»¬ä¸èƒ½ä»…ä»…åªä¿®æ”¹æŸä¸ª React element çš„ property æˆ–è€… childrenã€‚å¦‚æœä½ å¸Œæœ›ä¹‹åæ¸²æŸ“ä¸ä¸€æ ·çš„ä¸œè¥¿ï¼Œä½ éœ€è¦æè¿°ä¸€ä¸ªå…¨æ–°çš„ React element tree æ˜¯æ€ä¹ˆæ ·çš„ã€‚</p>
<p>æˆ‘å–œæ¬¢æŠŠ React elements æ¯”å–»æˆç”µå½±ä¸­çš„å¸§ã€‚å®ƒä»¬<strong>åˆ»ç”»</strong>äº†åœ¨æŸä¸€ä¸ªç‰¹æ®Šæ—¶é—´ç‚¹çš„ UI æ˜¯å¦‚ä½•å±•ç°çš„ã€‚</p>
<h2 id="entry-point"><a href="#entry-point" aria-label="entry point permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Entry Point</h2>
<p>æ¯ä¸€ä¸ª React renderer éƒ½æœ‰ä¸€ä¸ª â€œå…¥å£ï¼ˆentry pointï¼‰â€ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æ¥å‘Šè¯‰ React åœ¨æŒ‡å®šçš„ container host instance ä¸­æ¸²æŸ“ React Element çš„ APIã€‚
React DOM çš„å…¥å£å°±æ˜¯ <code class="language-text">ReactDOM.render</code></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token comment">// { type: 'button', props: { className: 'blue' } }</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å½“æˆ‘ä»¬æåˆ° <code class="language-text">ReactDOM.render(reactElement, domContainer)</code> å®ƒå°±æ„å‘³ç€ï¼Œ<strong>äº²çˆ±çš„ Reactï¼Œåœ¨è¿™ä¸ª <code class="language-text">domContainer</code>ä¸‹ç”Ÿæˆæˆ‘çš„ <code class="language-text">reactElement</code>ã€‚</strong></p>
<p>React å°†ä¼šæŸ¥æ‰¾ <code class="language-text">reactElement.type</code>ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ˜¯ <code class="language-text">button</code>ï¼‰ï¼Œè®© React DOM ä¸ºå®ƒç”Ÿæˆå¯¹åº”çš„çš„ host instanceï¼Œå¹¶è®¾ç½®å¥½ propertiesã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Somewhere in the ReactDOM renderer (simplified)</span>
<span class="token keyword">function</span> <span class="token function">createHostInstance</span><span class="token punctuation">(</span><span class="token parameter">reactElement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> reactElement<span class="token punctuation">.</span>props<span class="token punctuation">.</span>className<span class="token punctuation">;</span></span>  <span class="token keyword">return</span> domNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒReact å®é™…ä¸Šä¼šè¿™æ ·åšï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'blue'</span><span class="token punctuation">;</span></span>
domContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å¦‚æœ <code class="language-text">reactElements.props.children</code> å­˜åœ¨çš„è¯ï¼ŒReact åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼Œä¹Ÿä¼šå¯¹å®ƒä»¬é€’å½’åœ°åšåŒæ ·çš„äº‹æƒ…ã€‚</p>
<h2 id="reconciliation"><a href="#reconciliation" aria-label="reconciliation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reconciliation</h2>
<p>å¦‚æœæˆ‘ä»¬å¯¹åŒä¸€ä¸ª container è°ƒç”¨ä¸¤æ¬¡ <code class="language-text">ReactDOM.render</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span></span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ... later ...</span>

<span class="token comment">// æ˜¯æ›¿æ¢è¿™ä¸ª button çš„ host instance</span>
<span class="token comment">// è¿˜ä»…ä»…åªæ˜¯åœ¨ç°æœ‰ instance çš„æŠ€æœ¯ä¸Šï¼Œæ›´æ–° property</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span></span>  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åŒæ ·ï¼ŒReact çš„å·¥ä½œæ˜¯ä½¿ host tree å’Œæä¾›çš„ React element tree åŒ¹é…ã€‚è€Œç¡®å®šåœ¨å“åº”æ–°çš„æ•°æ®æ—¶éœ€è¦åšä»€ä¹ˆçš„è¿‡ç¨‹è¢«ç§°ä¸º <a href="https://reactjs.org/docs/reconciliation.html">reconciliation</a>ã€‚</p>
<p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥åšåˆ°è¿™ä¸ªï¼Œä¸€ä¸ªç®€åŒ–çš„ React å¯ä»¥é€šè¿‡æ¸…ç©ºç°æœ‰çš„æ ‘å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªæ¥è¾¾åˆ°æ•ˆæœã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> domContainer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Clear the tree</span>
domContainer<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token comment">// Create the new host instance tree</span>
<span class="token keyword">let</span> domNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
domContainer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>domNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ä½†æ˜¯åœ¨ DOM ä¸­ï¼Œè¿™ç§æ–¹å¼ä¸ä»…æ…¢ï¼Œè¿˜ä¼šä¸¢å¤±ç±»ä¼¼äº <strong>focusï¼Œselectionï¼Œscroll state</strong>ç­‰ç­‰ä¿¡æ¯ã€‚ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ› React å¯ä»¥åšåˆ°è¿™æ ·ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> domNode <span class="token operator">=</span> domContainer<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
<span class="token comment">// Update existing host instance</span>
domNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span></code></pre></div>
<p>æ¢å¥è¯è¯´ï¼ŒReact éœ€è¦å†³å®šä»€ä¹ˆæ—¶å€™å»æ›´æ–°ç°æœ‰çš„ host instance æ¥åŒ¹é…æ–°çš„ React elementï¼Œä»¥åŠä½•æ—¶åˆ›å»ºæ–°çš„ã€‚</p>
<p>è¿™å°±æŠ›å‡ºäº†ä¸€ä¸ªæœ‰å…³ <em>identity</em> çš„é—®é¢˜ã€‚React element æ¯æ¬¡éƒ½ä¼šæ˜¯å®Œå…¨ä¸åŒçš„ï¼Œä½†æ˜¯ä»€ä¹ˆæ—¶å€™å®ƒä»¬åœ¨æ¦‚å¿µä¸Šè¡¨ç¤ºçš„æ˜¯åŒä¸€ä¸ª instance å‘¢ï¼Ÿ</p>
<p>This raises a question of <em>identity</em>. The React element may be different every time, but when does it refer to the same host instance conceptually?</p>
<p>æˆ‘ä»¬çš„ä¾‹å­å¾ˆç®€å•ã€‚æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä»…ä»…åªæ¸²æŸ“ä¸€ä¸ª <code class="language-text">&lt;button&gt;</code>ï¼Œæˆ‘ä»¬æƒ³åœ¨åŒæ ·çš„åœ°æ–¹å†æ¸²æŸ“ä¸€æ¬¡ <code class="language-text">&lt;button&gt;</code>ã€‚æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª <code class="language-text">&lt;button&gt;</code> instanceï¼Œä¸ºä»€ä¹ˆéœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªå‘¢ï¼Ÿé‡ç”¨å®ƒï¼</p>
<p>è¿™å·²ç»éå¸¸æ¥è¿‘ React æ€è€ƒçš„æ–¹å¼äº†ã€‚</p>
<p><strong>å¦‚æœæ ‘ä¸­åŒæ ·åœ°æ–¹çš„ element type åœ¨ä¸€æ¬¡æ›´æ–°åï¼Œå’Œä¸Šä¸€ä¸ª element çš„ type åŒ¹é…ï¼Œé‚£ä¹ˆ React å°±ä¼šé‡ç”¨å…ˆæœ‰çš„ host instanceã€‚</strong></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¦äº†æ³¨é‡Šçš„ç²—ç³™çš„ä¾‹å­ï¼Œæ¥è§£é‡Š React æ€ä¹ˆåšï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// let domNode = document.createElement('button');</span>
<span class="token comment">// domNode.className = 'blue';</span>
<span class="token comment">// domContainer.appendChild(domNode);</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>blue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token comment">// Can reuse host instance? Yes! (button â†’ button)</span></span><span class="gatsby-highlight-code-line"><span class="token comment">// domNode.className = 'red';</span></span>ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>red<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token comment">// Can reuse host instance? No! (button â†’ p)</span></span><span class="token comment">// domContainer.removeChild(domNode);</span>
<span class="token comment">// domNode = document.createElement('p');</span>
<span class="token comment">// domNode.textContent = 'Hello';</span>
<span class="token comment">// domContainer.appendChild(domNode);</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Can reuse host instance? Yes! (p â†’ p)</span>
<span class="token comment">// domNode.textContent = 'Goodbye';</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Goodbye</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å­èŠ‚ç‚¹ä»¬ä½¿ç”¨åŒæ ·çš„å¯å‘å¼æ–¹æ³•. å½“æˆ‘ä»¬æ›´æ–°ä¸€ä¸ª æ‹¥æœ‰ä¸¤ä¸ª <code class="language-text">&lt;button&gt;</code> çš„ <code class="language-text">&lt;dialog&gt;</code> çš„æ—¶å€™ï¼ŒReact é¦–å…ˆä¼šå†³å®šæ˜¯å¦è¦å¤ç”¨ <code class="language-text">&lt;dialog&gt;</code>ï¼Œå¹¶å¯¹æ¯ä¸€ä¸ªå­èŠ‚ç‚¹é‡å¤è¿™ä¸ªå†³ç­–è¿‡ç¨‹ã€‚</p>
<h2 id="conditions"><a href="#conditions" aria-label="conditions permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conditions</h2>
<p>å¦‚æœ React ä»…ä»…æ¯æ¬¡æ›´æ–°çš„æ—¶å€™ï¼Œ element type åŒ¹é…æ‰å¤ç”¨ host instance çš„è¯ï¼Œå®ƒä»¬å¦‚ä½•æ¸²æŸ“æ¡ä»¶è¯­å¥é‡Œçš„å†…å®¹ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬ç¬¬ä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™åªæœ‰ä¸€ä¸ª inputï¼Œæ¥ç€åœ¨ input ä¹‹å‰æ¸²æŸ“ä¸€ä¸ª messageï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// First render</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Next render</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">I was just added here!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code class="language-text">&lt;input&gt;</code> çš„ host instance å°†ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªã€‚React å°†ä¼šéå† element treeï¼Œå°†å…¶ä¸ä¹‹å‰çš„ç‰ˆæœ¬æ¯”è¾ƒï¼š</p>
<ul>
<li><code class="language-text">dialog â†’ dialog</code>: æˆ‘ä»¬èƒ½é‡ç”¨ host instance ä¹ˆï¼Ÿ<strong>å¯ä»¥ï¼Œtype å¯¹ä¸Šäº†</strong></li>
<li><code class="language-text">input â†’ p</code>: æˆ‘ä»¬èƒ½é‡ç”¨ host instance ä¹ˆï¼Ÿ <strong>ä¸è¡Œï¼Œtype æ”¹å˜äº†ï¼</strong> éœ€è¦ç§»é™¤ç°æœ‰çš„ <code class="language-text">input</code> å¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ <code class="language-text">p</code> host instanceã€‚</li>
<li><code class="language-text">(nothing â†’ input</code>: éœ€è¦æ–°å»ºä¸€ä¸ª <code class="language-text">input</code> host instanceã€‚</li>
</ul>
<p>æ‰€ä»¥å®é™…ä¸Šï¼ŒReact çš„æ›´æ–°ä»£ç å°±è¿™æ ·æ‰§è¡Œï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="gatsby-highlight-code-line"><span class="token keyword">let</span> oldInputNode <span class="token operator">=</span> dialogNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">dialogNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>oldInputNode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="token keyword">let</span> pNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pNode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'I was just added here!'</span><span class="token punctuation">;</span>
dialogNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>pNode<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">let</span> newInputNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">dialogNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newInputNode<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>è¿™å…¶å®ä¸æ˜¯å¾ˆé…·å› ä¸ºä»æ¦‚å¿µä¸Šæ¥è¯´ï¼Œ<code class="language-text">&lt;input&gt;</code> å¹¶ä¸åº”è¯¥è¢« <code class="language-text">&lt;p&gt;</code> æ›¿æ¢â€”å®ƒä»…ä»…åªæ˜¯ç§»åŠ¨äº†ä¸€ä¸‹ä½ç½®ã€‚æˆ‘ä»¬ä¸å¸Œæœ›å› ä¸ºé‡æ–°åˆ›å»ºäº†ä¸€ä¸ªè€Œå¤±å»å®ƒçš„ selectionï¼Œfocus stateï¼Œcontent</p>
<p>ç„¶è€Œè¿™ä¸ªé—®é¢˜å…¶å®å¾ˆå®¹æ˜“è¢«ä¿®å¤ï¼Œåœ¨å®é™…ä½¿ç”¨ React çš„åœºæ™¯ä¸­ï¼Œå®ƒä¸ä¼šå‘ç”Ÿã€‚</p>
<p>åœ¨å®é™…ä¸­ï¼Œä½ å¾ˆå°‘ä¼šç›´æ¥è°ƒç”¨ <code class="language-text">ReactDOM.render</code>ï¼Œç›¸ååœ°ï¼Œä½ ä¼šæŠŠä»£ç æ‹†è§£æˆä¸‹é¢è¿™æ ·ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> showMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">I was just added here!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿™ä¸ªä¾‹å­å°±ä¸ä¼šç¢°åˆ°ä¸Šé¢æåˆ°çš„é—®é¢˜äº†ã€‚æˆ‘ä»¬ç”¨ object å­—é¢é‡çš„å½¢å¼æ¥å–ä»£ JSX å¯èƒ½ä¼šæ›´å®¹æ˜“è§£é‡Šä¸ºä»€ä¹ˆã€‚çœ‹ä¸‹ <code class="language-text">dialog</code> æ‰€å¯¹åº”çš„ element treeï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> showMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
      props<span class="token punctuation">:</span> <span class="token punctuation">{</span> children<span class="token punctuation">:</span> <span class="token string">'I was just added here!'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'dialog'</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">      children<span class="token punctuation">:</span> <span class="token punctuation">[</span>message<span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span> props<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span></span></code></pre></div>
<p><strong>ä¸ç®¡ <code class="language-text">showMessage</code> æ˜¯ <code class="language-text">true</code> è¿˜æ˜¯ <code class="language-text">false</code>ï¼Œ<code class="language-text">&lt;input&gt;</code> éƒ½æ˜¯ç¬¬äºŒä¸ªå­èŠ‚ç‚¹ï¼Œå› æ­¤åœ¨æ¯æ¬¡ render çš„æ—¶å€™ï¼Œå®ƒåœ¨æ ‘ä¸­è¿˜æ˜¯åœ¨åŒä¸€ä¸ªä½ç½®ã€‚</strong></p>
<p>å¦‚æœ <code class="language-text">showMessage</code> ä» <code class="language-text">false</code> å˜ä¸º <code class="language-text">true</code>ï¼ŒReact å°±ä¼šéå† element æ ‘ï¼Œå’Œå®ƒä¸Šä¸€ä¸ªç‰ˆæœ¬æ¯”è¾ƒï¼š</p>
<ul>
<li>
<p><code class="language-text">dialog â†’ dialog</code>: æˆ‘å¯ä»¥é‡ç”¨ host instance å—? <strong>å¯ä»¥ï¼Œtype æ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<ul>
<li><code class="language-text">(null) â†’ p</code>: éœ€è¦æ’å…¥ä¸€ä¸ªæ–°çš„ <code class="language-text">p</code> host instanceã€‚</li>
<li><code class="language-text">input â†’ input</code>: æˆ‘å¯ä»¥é‡ç”¨ host instance å—? <strong>å½“ç„¶ï¼Œtype æ²¡æœ‰å˜ï¼</strong></li>
</ul>
</li>
</ul>
<p>æ¥ç€ React ä¼šæ‰§è¡Œç±»ä¼¼çš„ä»£ç ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> inputNode <span class="token operator">=</span> dialogNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
<span class="token keyword">let</span> pNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pNode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'I was just added here!'</span><span class="token punctuation">;</span>
dialogNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>pNode<span class="token punctuation">,</span> inputNode<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å†ä¹Ÿæ²¡æœ‰ input state ä¼šä¸¢å¤±äº†ã€‚</p>
<h2 id="lists"><a href="#lists" aria-label="lists permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lists</h2>
<p>é€šè¿‡æ¯”è¾ƒ element type åœ¨åŒä¸€ä½ç½®æ˜¯å¦æ”¹å˜çš„æ–¹å¼ï¼Œåœ¨å¤§å¤šæ•°æ—¶å€™éƒ½å¯ä»¥ç¡®å®šæ˜¯é‡ç”¨è¿˜æ˜¯é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ host instanceã€‚</p>
<p>ä½†æ˜¯è¿™åªæœ‰åœ¨å­èŠ‚ç‚¹æ˜¯å›ºå®šå¹¶ä¸”ä¸éœ€è¦é‡æ’çš„æƒ…å†µä¸‹ã€‚åœ¨æˆ‘ä»¬ä¸Šé¢çš„ä¾‹å­ï¼Œå³ä½¿ <code class="language-text">message</code> å˜é‡å¯ä»¥æ˜¯ä¸€ä¸ª â€œholeâ€ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ç¡®å®š input åœ¨ message ä¹‹åï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–å­èŠ‚ç‚¹äº†ã€‚</p>
<p>åœ¨åŠ¨æ€åˆ—è¡¨ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ä¿è¯å®ƒä»¬çš„é¡ºåºæ˜¯å¦æ°¸è¿œä¸å˜ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ShoppingList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> list <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">
          You bought </span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text">
          Enter how many do you want: </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä»¬çš„ Shopping List é‡Œçš„ items å‘ç”Ÿäº†é‡æ’ï¼ŒReact åˆ™ä¼šè®¤ä¸ºæ‰€æœ‰çš„ <code class="language-text">p</code> å’Œ <code class="language-text">input</code> éƒ½å’Œä¹‹å‰æ˜¯ä¸€æ ·çš„ typeï¼Œè€Œä¸ä¼šå»ç§»åŠ¨å®ƒä»¬ã€‚ä» React çš„è§’åº¦æ¥çœ‹ï¼Œæ˜¯<em>items è‡ªèº«</em>å˜äº†ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„é¡ºåºã€‚</p>
<p>React åœ¨é‡æ’ 10 ä¸ª items æ—¶ä¼šæ‰§è¡Œè¿™æ®µä»£ç ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pNode <span class="token operator">=</span> formNode<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> textNode <span class="token operator">=</span> pNode<span class="token punctuation">.</span>firstChild<span class="token punctuation">;</span>
  textNode<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'You bought '</span> <span class="token operator">+</span> items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ‰€ä»¥ React å®é™…ä¸Šä¼šæ›´æ–°æ¯ä¸ª DOM èŠ‚ç‚¹è€Œä¸æ˜¯é‡æ’å®ƒä»¬ã€‚è¿™ä¼šé€ æˆæ€§èƒ½é—®é¢˜å’Œ bug ğŸ›ã€‚æ¯”å¦‚æˆ‘ä»¬çš„åœ¨ç¬¬ä¸€è¡Œè¾“å…¥çš„å†…å®¹ <code class="language-text">how many you want</code>ï¼Œä¼šåœ¨é‡æ’åä¾ç„¶æ˜¾ç¤ºåœ¨ç¬¬ä¸€è¡Œã€‚ä½†å…¶å®å¯¹åº”çš„é‚£ä¸ª items å·²ç»ä¸æ˜¯ç¬¬ä¸€è¡Œäº†ï¼</p>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React æ¯æ¬¡éƒ½ä¼šåœ¨ä½ éœ€è¦æ¸²æŸ“ä¸€ä¸ª array çš„æ—¶å€™ä¸åœåœ°å” å¨ï¼Œè€é“ä½ çš„ key ä¸¢äº†ï¼</strong></p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ShoppingList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> list <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token punctuation">{</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>productId<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">          You bought </span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">          Enter how many do you want: </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">key</code> å‘Šè¯‰ Reactï¼Œè¿™äº› item å³ä½¿åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´å¯¹äºå®ƒä»¬çš„çˆ¶å…ƒç´ æ¥è¯´ä½äºä¸åŒçš„ä½ç½®ï¼Œåœ¨æ¦‚å¿µä¸Šä¹Ÿåº”è¯¥è®¤ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ªã€‚</p>
<p>å½“ React å‘ç° <code class="language-text">&lt;p key=&quot;42&quot;&gt;</code> åœ¨ <code class="language-text">&lt;form&gt;</code> é‡Œçš„æ—¶å€™ï¼Œå®ƒä¼šæ£€æµ‹ä¸Šä¸€æ¬¡ render æ˜¯å¦ä¹ŸåŒ…å«äº† <code class="language-text">&lt;p key=&quot;42&quot;&gt;</code> åœ¨åŒä¸€ä¸ª <code class="language-text">&lt;form&gt;</code> ä¸­ã€‚å³ä½¿ <code class="language-text">&lt;form&gt;</code> çš„å­èŠ‚ç‚¹çš„é¡ºåºæ”¹å˜äº†ä¹Ÿèƒ½ç”Ÿæ•ˆã€‚å¦‚æœå­˜åœ¨ï¼ŒReact å°†ä¼šé‡ç”¨è¿™ä¸ª key ä¹‹å‰çš„ host instanceï¼Œå¹¶å“åº”åœ°é‡æ‹å®ƒçš„åŒèƒèŠ‚ç‚¹ã€‚</p>
<p>æ³¨æ„ <code class="language-text">key</code> ä»…ä»…å’Œå®ƒæœ€è¿‘çš„çˆ¶èŠ‚ç‚¹æœ‰å…³ï¼Œå¯¹äº <code class="language-text">&lt;p&gt;</code> å®ƒå°±æ˜¯ <code class="language-text">&lt;form&gt;</code>ã€‚React ä¸ä¼šå°è¯•åœ¨ä¸åŒçš„ parents ä¸­åŒ¹é…åŒä¸€ä¸ª keyï¼ŒReact ä¹Ÿæ²¡æœ‰åŸç”Ÿæ”¯æŒå¦‚ä½•åœ¨ä¸é‡æ–°åˆ›å»º host instance çš„æƒ…å†µä¸‹ï¼Œå°†å®ƒç§»åŠ¨åˆ°å¦å¤–ä¸€ä¸ªçˆ¶å…ƒç´ ä¸­ã€‚</p>
<p><code class="language-text">key</code> åº”è¯¥å–ä»€ä¹ˆå€¼æ‰å¥½å‘¢ï¼Ÿå¯ä»¥é—®è‡ªå·±ä¸€ä¸ªç®€å•çš„é—®é¢˜ï¼š<strong>å“ªäº›é¡¹åœ¨é‡æ’ä¹‹åä¾ç„¶å¯ä»¥ä¿æŒä¸å˜ï¼Ÿ</strong>æ¯”å¦‚ï¼Œåœ¨è´­ç‰©è½¦ä¸­ï¼Œproduct Id å°±å”¯ä¸€æ ‡ç¤ºäº†ä¸€ä¸ªå•†å“ã€‚</p>
<h2 id="components"><a href="#components" aria-label="components permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Components</h2>
<p>æˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°é‚£äº›ä¼šè¿”å› React element çš„å‡½æ•°äº†ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> showMessage <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showMessage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    message <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">I was just added here!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dialog</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dialog</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å®ƒä»¬è¢«ç§°ä¸º <em>components</em>ã€‚å®ƒä»¬è®©æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„ buttonsï¼Œavatarsï¼Œcomments ç­‰ç­‰ç™¾å®ç®± ğŸ§°ã€‚å¯ä»¥è¯´ Component æ˜¯ React çš„é¢åŒ… ğŸ å’Œé»„æ²¹ã€‚</p>
<p>Components æ¥å—ä¸€ä¸ªå‚æ•°â€”ä¸€ä¸ªå¯¹è±¡ã€‚å®ƒåŒ…å«äº† â€œpropsâ€ï¼ˆâ€propertiesâ€ çš„ç®€å†™ï¼‰ã€‚ä¸Šé¢çš„ <code class="language-text">showMessage</code> å°±æ˜¯ä¸€ä¸ª propï¼Œå®ƒä»¬å°±åƒå‘½åçš„å‚æ•°ä¸€æ ·ã€‚ï¼ˆè¯‘è€…æ³¨ï¼Œå…¶å®å°±æ˜¯ JS ä¸æ”¯æŒç»™å‡½æ•°çš„å‚æ•°åŠ ä¸Šåˆ«åï¼Œè€Œæ¥å—ä¸€ä¸ª Object å¯ä»¥èµ·åˆ°ç±»ä¼¼çš„æ•ˆæœï¼‰</p>
<h2 id="purity"><a href="#purity" aria-label="purity permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Purity</h2>
<p>React components çš„ props ä¼šè¢«å‡è®¾ä¸ºçº¯ï¼ˆpureï¼‰çš„ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ğŸ”´ Doesn't work</span>
  props<span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œmutation æ˜¯ä¸ç¬¦åˆ React çš„æœ€ä½³å®è·µçš„ã€‚ä¸è¿‡ï¼Œ<em>local mutation</em> æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">FriendList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> friends <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">let</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> friends<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> friend <span class="token operator">=</span> friends<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">    items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Friend</span></span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">.</span>id<span class="token punctuation">}</span></span> <span class="token attr-name">friend</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>friend<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>items<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æˆ‘ä»¬åœ¨æ¸²æŸ“çš„æ—¶å€™åˆ›å»ºäº† <code class="language-text">items</code>ï¼Œåœ¨è¿™ä¹‹å‰æ²¡æœ‰å…¶ä»–ç»„ä»¶â€œè§è¿‡â€å®ƒã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å°†å®ƒä½œä¸ºæ¸²æŸ“ç»“æœä¹‹å‰ï¼ŒæŒ‰è‡ªå·±å–œæ¬¢çš„æ–¹å¼ä¿®æ”¹å®ƒï¼Œè€Œä¸éœ€è¦ä¸ºäº†ä¿å­˜<strong>çº¯ç²¹æ€§</strong>è€Œæ‰­æ›²ä½ çš„ä»£ç ã€‚</p>
<p>åŒæ ·çš„ï¼Œå»¶è¿Ÿåˆå§‹åŒ–(lazy initialization) è™½ç„¶ä¸æ˜¯çº¯ï¼Œä½†ä¾æ—§å¾ˆæ£’ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">ExpenseForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fine if it doesn't affect other components:</span>
  SuperCalculator<span class="token punctuation">.</span><span class="token function">initializeIfNotReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Continue rendering...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åªè¦å¤šæ¬¡è°ƒç”¨ä¸€ä¸ªç»„ä»¶æ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“å…¶ä»–ç»„ä»¶çš„æ¸²æŸ“æ•ˆæœï¼ŒReact å¹¶ä¸å…³å¿ƒä½ çš„ä»£ç æ˜¯å¦åœ¨ FP çš„ä¸–ç•Œä¸­æ˜¯ç™¾åˆ†ä¹‹ç™¾çº¯çš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šå¸¦æ¥å‰¯ä½œç”¨ä»è€Œå½±å“æ˜¾ç¤ºæ•ˆæœçš„ Component åœ¨ React ä¸­æ˜¯ä¸è¢«æ¥å—çš„ã€‚æ¢å¥è¯è¯´ï¼Œä»…ä»…è°ƒç”¨ Component çš„æ–¹æ³•æœ¬èº«ï¼Œä¸åº”è¯¥åœ¨å±å¹•ä¸Šäº§ç”Ÿä»»ä½•å˜åŒ–ã€‚ï¼ˆè¯‘è€…æ³¨ï¼Œä¹Ÿå°±æ˜¯ Component æœ¬èº«ï¼Œä¸åº”è¯¥æœ‰ç±»ä¼¼äºå»ä¿®æ”¹ <code class="language-text">window</code>ï¼Œæˆ–è€…é‡Œé¢æœ‰ä¸€ä¸ª <code class="language-text">ReactDOM.render</code>)</p>
<h2 id="recursion"><a href="#recursion" aria-label="recursion permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recursion</h2>
<p>æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨ä¸€ä¸ª component ä¸­ä½¿ç”¨å…¶ä»–çš„ componentsï¼ŸComponents å…¶å®éƒ½æ˜¯å‡½æ•°æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒä»¬ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">let</span> reactElement <span class="token operator">=</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">{</span> showMessage<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">,</span> domContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ç„¶åï¼Œè¿™ç§æ–¹å¼å¹¶ä¸å¯¹ React runtime çš„èƒƒå£ã€‚</p>
<p>ç›¸åï¼ŒReact æ­£ç»Ÿåœ°ä½¿ç”¨ components çš„æ–¹å¼ä¸æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°å¾—ä¸€æ ·â€”React elementsã€‚<strong>è¿™å°±æ„å‘³ç€ï¼Œä½ ä¸æ˜¯ç›´æ¥è°ƒç”¨ component è¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯è®© React æ¥å¸®ä½ åšã€‚</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// { type: Form, props: { showMessage: true } }</span>
<span class="token keyword">let</span> reactElement <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form</span></span> <span class="token attr-name">showMessage</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>reactElement<span class="token punctuation">,</span> domContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åœ¨ React çš„æŸå¤„ï¼Œä½ çš„ component å°†ä¼šè¢«è°ƒç”¨ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Somewhere inside React</span>
<span class="token keyword">let</span> type <span class="token operator">=</span> reactElement<span class="token punctuation">.</span>type<span class="token punctuation">;</span> <span class="token comment">// Form</span>
<span class="token keyword">let</span> props <span class="token operator">=</span> reactElement<span class="token punctuation">.</span>props<span class="token punctuation">;</span> <span class="token comment">// { showMessage: true }</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Whatever Form returns</span></code></pre></div>
<p>Component function å‘½åé‡‡ç”¨çš„æ˜¯é¦–å­—æ¯å¤§å†™çš„æ–¹å¼ï¼Œå½“ JSX è½¬è¯‘çš„æ—¶å€™ç¢°åˆ° <code class="language-text">&lt;Form&gt;</code> è€Œä¸æ˜¯ <code class="language-text">&lt;form&gt;</code> çš„æ—¶å€™ï¼Œå®ƒä¼šå°† type èµ‹å€¼ä¸º Form æœ¬èº«è€Œä¸æ˜¯å­—ç¬¦ä¸² â€œformâ€ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token punctuation">/></span></span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'form' string</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Form</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Form function</span></code></pre></div>
<p>React ä¸­å¹¶æ²¡æœ‰å…¨å±€æ³¨å†Œçš„æœºåˆ¶â€”å½“ä½ è¾“å…¥ <code class="language-text">&lt;Form /&gt;</code> çš„æ—¶å€™å®ƒä¼šæŒ‰å­—é¢ä¸Šå£°æ˜çš„ <code class="language-text">Form</code> æ¥å¼•ç”¨ã€‚å¦‚æœ <code class="language-text">Form</code> åœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­ä¸å­˜åœ¨çš„è¯ï¼Œä½ å°±ä¼šçœ‹åˆ° JS æŠ¥ä¸€ä¸ªå’Œä½ å¹³æ—¶ä½¿ç”¨äº†é”™è¯¯çš„å˜é‡åä¸€æ ·çš„é”™è¯¯ã€‚</p>
<p>**Okayï¼Œæ‰€ä»¥å½“ element çš„ type æ˜¯ä¸€ä¸ª function çš„æ—¶å€™ React åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿå®ƒè°ƒç”¨ä½ çš„ componentï¼Œå¹¶è¯¢é—®è¯¥ component æƒ³è¦æ¸²æŸ“çš„ elementã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¼šä¸åœçš„é€’å½’ä¸‹å»ï¼Œæ›´å¤šçš„ç»†èŠ‚å¯ä»¥åœ¨<a href="https://reactjs.org/blog/2015/12/18/react-components-elements-and-instances.html">è¿™é‡Œ</a>çœ‹åˆ°ã€‚ç®€å•çš„å½¢å¼å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<ul>
<li><strong>ä½ ï¼š</strong> <code class="language-text">ReactDOM.render(&lt;App /&gt;, domContainer)</code></li>
<li>
<p><strong>React:</strong> Hey <code class="language-text">App</code>ï¼Œ ä½ æƒ³æ¸²æŸ“ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><code class="language-text">App</code>: æˆ‘æ¸²æŸ“ä¸€ä¸ªåŒ…å«äº† <code class="language-text">&lt;Content&gt;</code> çš„ <code class="language-text">&lt;Layout&gt;</code></li>
</ul>
</li>
<li>
<p><strong>React:</strong> Hey <code class="language-text">Layout</code>, ä½ æƒ³æ¸²æŸ“ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><code class="language-text">Layout</code>: æˆ‘åœ¨ä¸€ä¸ª <code class="language-text">div</code> ä¸­æ¸²æŸ“æˆ‘çš„ childrenã€‚æˆ‘çš„å­èŠ‚ç‚¹æœ‰ä¸€ä¸ª <code class="language-text">&lt;Content&gt;</code> è¯´ä½ çŒœè¿™ä¼šè¿›å…¥ <code class="language-text">&lt;div&gt;</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>React:</strong> Hey <code class="language-text">&lt;Content&gt;</code>, ä½ æƒ³æ¸²æŸ“ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li><code class="language-text">Content</code>: æˆ‘æ¸²æŸ“ä¸€ä¸ªæ‹¥æœ‰ä¸€äº› text çš„ <code class="language-text">&lt;article&gt;</code>ï¼Œå®ƒè¿˜åŒ…å«äº†ä¸ª <code class="language-text">&lt;Footer&gt;</code></li>
<li><strong>React:</strong> Hey <code class="language-text">&lt;Footer&gt;</code>, ä½ æƒ³æ¸²æŸ“ä»€ä¹ˆï¼Ÿ</li>
<li><code class="language-text">Footer</code>: æˆ‘æ¸²æŸ“ä¸€ä¸ªæ‹¥æœ‰å¾ˆå¤š text çš„ <code class="language-text">&lt;footer&gt;</code>ã€‚</li>
</ul>
</li>
<li><strong>React:</strong> Okay, èµ·é£å§:</li>
</ul>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Resulting DOM structure</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span><span class="token punctuation">></span></span><span class="token plain-text">
    Some text
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">></span></span><span class="token plain-text">some more text</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre></div>
<p>è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆè¯´ reconciliation æ˜¯é€’å½’çš„äº†ã€‚å½“ React éå† element tree çš„æ—¶å€™ï¼Œå®ƒä¼šç¢°åˆ°é‚£äº› <code class="language-text">type</code> ä¸º component çš„ elementï¼Œæ¥ç€ä¼šè°ƒç”¨å®ƒå¹¶ä¿æŒ component è¿”å›çš„ element çš„é¡ºåºç»§ç»­æ‰§è¡Œã€‚æœ€ç»ˆæˆ‘ä»¬å°†ä¼šéå†æ‰€æœ‰çš„ componentsï¼ŒReact ä¹Ÿå°±çŸ¥é“äº†å¦‚ä½•æ”¹å˜ host treeã€‚</p>
<p>æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ reconciliation çš„è§„åˆ™åœ¨è¿™é‡Œä¾ç„¶é€‚ç”¨ã€‚å¦‚æœç›¸åŒä½ç½®(ç”± index å’Œå¯é€‰çš„ <code class="language-text">key</code> å…±åŒå†³å®šï¼‰çš„ <code class="language-text">type</code> å‘ç”Ÿäº†æ”¹å˜ï¼ŒReact å°†ä¼šç§»é™¤å½“å‰ element ä¸­æ‰€æœ‰çš„ host instance å¹¶é‡æ–°åˆ›å»ºå®ƒä»¬ã€‚</p>
<h2 id="inversion-of-control"><a href="#inversion-of-control" aria-label="inversion of control permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inversion of Control</h2>
<p>ä½ å¯ä»¥æƒ³çŸ¥é“ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸çŸ¥é“è°ƒç”¨ component å‘¢ï¼Ÿä¸ºä»€ä¹ˆè¦å†™æˆ <code class="language-text">&lt;Form /&gt;</code> è€Œä¸æ˜¯ <code class="language-text">Form()</code>ï¼Ÿ</p>
<p><strong>å¦‚æœ React èƒ½æå‰ â€œäº†è§£â€ åˆ°ä½ çš„ component å®šä¹‰ï¼Œè€Œä¸æ˜¯åªæœ‰åœ¨é€’å½’è°ƒç”¨å®ƒåæ‰çœ‹åˆ°è¿”å›çš„ element çš„è¯ï¼ŒReact å°±å¯ä»¥æ›´å¥½çš„å·¥ä½œ</strong></p>
<p><strong>React can do its job better if it â€œknowsâ€ about your components rather than if it only sees the React element tree after recursively calling them.</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ”´ React has no idea Layout and Article exist.</span>
<span class="token comment">// You're calling them.</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token function">Layout</span><span class="token punctuation">(</span><span class="token punctuation">{</span> children<span class="token punctuation">:</span> <span class="token function">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> domContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// âœ… React knows Layout and Article exist.</span>
<span class="token comment">// React calls them.</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Layout</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Layout</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
  domContainer
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„<a href="https://en.wikipedia.org/wiki/Inversion_of_control">æ§åˆ¶åè½¬</a>çš„ä¾‹å­ã€‚é€šè¿‡è®© React æ¥æ§åˆ¶å¦‚ä½•è°ƒç”¨ç»„ä»¶çš„è¯ï¼Œå¯ä»¥å¾—åˆ°ä¸€äº›æœ‰è¶£çš„å±æ€§ï¼š</p>
<ul>
<li>
<p><strong>Components become more than functions.</strong> React can augment component functions with features like <em>local state</em> that are tied to the component identity in the tree. A good runtime provides fundamental abstractions that match the problem at hand. As we already mentioned, React is oriented specifically at programs that render UI trees and respond to interactions. If you called components directly, youâ€™d have to build these features yourself.</p>
</li>
<li>
<p><strong>Component types participate in the reconciliation.</strong> By letting React call your components, you also tell it more about the conceptual structure of your tree. For example, when you move from rendering <code class="language-text">&lt;Feed&gt;</code> to the <code class="language-text">&lt;Profile&gt;</code> page, React wonâ€™t attempt to re-use host instances inside them â€” just like when you replace <code class="language-text">&lt;button&gt;</code> with a <code class="language-text">&lt;p&gt;</code>. All state will be gone â€” which is usually good when you render a conceptually different view. You wouldnâ€™t want to preserve input state between <code class="language-text">&lt;PasswordForm&gt;</code> and <code class="language-text">&lt;MessengerChat&gt;</code> even if the <code class="language-text">&lt;input&gt;</code> position in the tree accidentally â€œlines upâ€ between them.</p>
</li>
<li>
<p><strong>React can delay the reconciliation.</strong> If React takes control over calling our components, it can do many interesting things. For example, it can let the browser do some work between the component calls so that re-rendering a large component tree <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">doesnâ€™t block the main thread</a>. Orchestrating this manually without reimplementing a large part of React is difficult.</p>
</li>
<li>
<p><strong>A better debugging story.</strong> If components are first-class citizens that the library is aware of, we can build <a href="https://github.com/facebook/react-devtools">rich developer tools</a> for introspection in development.</p>
</li>
</ul>
<p>æœ€åä¸€ä¸ªä¼˜åŠ¿æ˜¯ <em>lazy evaluationï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰</em>ï¼Œä¸€èµ·çœ‹çœ‹è¿™æ„å‘³ç€ä»€ä¹ˆã€‚</p>
<h2 id="lazy-evaluation"><a href="#lazy-evaluation" aria-label="lazy evaluation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Lazy Evaluation</h2>
<p>å½“æˆ‘ä»¬åœ¨ JS ä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®å‚ä¼šåœ¨è°ƒç”¨ä¹‹å‰å°±è¢«æ±‚å€¼ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// (2) This gets computed second</span>
<span class="token function">eat</span><span class="token punctuation">(</span>
  <span class="token comment">// (1) This gets computed first</span>
  <span class="token function">prepareMeal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>è¿™ç§è¡Œä¸ºé€šå¸¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œå› ä¸ºè¿™äº›å‡½æ•°èƒ½å¸¦æ¥éšå«çš„å‰¯ä½œç”¨ã€‚è€Œå¦‚æœæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç›´åˆ°æˆ‘ä»¬ä»¥æŸç§æ–¹å¼ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œçš„è¯ï¼Œè¿™ä¼šè®©æˆ‘ä»¬æ„Ÿåˆ°å¾ˆè¯§å¼‚ã€‚</p>
<p>ä¸è¿‡ï¼ŒReact components ç›¸å¯¹çº¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœçŸ¥é“å®ƒçš„ç»“æœä¸ä¼šåœ¨å±å¹•ä¸Šå‘ˆç°çš„è¯ï¼Œå°±å®Œå…¨æ²¡æœ‰å¿…è¦æ‰§è¡Œå®ƒçš„ã€‚</p>
<p>è€ƒè™‘è¿™ä¸ª <code class="language-text">&lt;Comments&gt;</code> æ’å…¥åˆ° <code class="language-text">&lt;Page&gt;</code> ä¸­çš„ç»„ä»¶ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Story</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> currentUser <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// return {</span>
  <span class="token comment">//   type: Page,</span>
  <span class="token comment">//   props: {</span>
  <span class="token comment">//     user: currentUser,</span>
  <span class="token comment">//     children: { type: Comments, props: {} }</span>
  <span class="token comment">//   }</span>
  <span class="token comment">// }</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page</span></span> <span class="token attr-name">user</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>currentUser<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Comments</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Page</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><code class="language-text">Page</code> ä¼šå°†å®ƒçš„ children åœ¨ <code class="language-text">Layout</code> ä¸­æ¸²æŸ“ã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> currentUser<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Layout</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Layout</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><em>(åœ¨ JSX ä¸­ <code class="language-text">&lt;A&gt;&lt;B /&gt;&lt;/A&gt;</code> å’Œ <code class="language-text">&lt;A children={&lt;B /&gt;} /&gt;</code> ç­‰ä»·ã€‚)</em></p>
<p>ä½†æ˜¯å¦‚æœæœ‰æå‰æå‡ºçš„æ¡ä»¶å‘¢ï¼Ÿ</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> currentUser<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUser<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Please login</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span></span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Layout</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Layout</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä»¬åƒå‡½æ•°ä¸€æ ·è°ƒç”¨è¿™ä¸ª <code class="language-text">Comments()</code>ï¼Œå®ƒéƒ½ä¼šç«‹åˆ»æ‰§è¡Œã€‚æ— è®º <code class="language-text">Page</code> æ˜¯å¦éœ€è¦å®ƒï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// {</span>
<span class="token comment">//   type: Page,</span>
<span class="token comment">//   props: {</span>
<span class="gatsby-highlight-code-line"><span class="token comment">//     children: Comments() // Always runs!</span></span><span class="token comment">//   }</span>
<span class="token comment">// }</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">Comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Page</span></span><span class="token punctuation">></span></span></code></pre></div>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ é€’ä¸€ä¸ª React element è¿›å»çš„è¯ï¼Œå°±ä¸ä¼šç«‹åˆ»æ‰§è¡Œ <code class="language-text">Comments</code> äº†ã€‚
But if we pass a React element, we donâ€™t execute <code class="language-text">Comments</code> ourselves at all:</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// {</span>
<span class="token comment">//   type: Page,</span>
<span class="token comment">//   props: {</span>
<span class="gatsby-highlight-code-line"><span class="token comment">//     children: { type: Comments }</span></span><span class="token comment">//   }</span>
<span class="token comment">// }</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Page</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Comments</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Page</span></span><span class="token punctuation">></span></span></code></pre></div>
<p>è¿™å°±è®© React å†³å®šä½•æ—¶ï¼Œæ˜¯å¦è°ƒç”¨ component å‡½æ•°ã€‚å¦‚æœ <code class="language-text">Page</code> component å®é™…ä¸Šå¿½ç•¥ <code class="language-text">children</code> prop è€Œä»…ä»…æ¸²æŸ“ <code class="language-text">&lt;h1&gt;Please login&lt;/h1&gt;</code> çš„è¯ï¼ŒReact æ ¹æœ¬å°±ä¸ä¼šå°è¯•å»è°ƒç”¨ <code class="language-text">Comments</code> å‡½æ•°ã€‚æŒºé…·çš„å§ ğŸ˜ï¼Ÿ</p>
<p>è¿™è®©æˆ‘ä»¬çœå»äº†ä¸å¿…è¦çš„æ¸²æŸ“å·¥ä½œï¼Œå¹¶è®©æˆ‘ä»¬çš„ä»£ç æ›´åŠ å¥å£®ã€‚ï¼ˆåœ¨ç”¨æˆ·æ³¨é”€åï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒ<code class="language-text">Comments</code> æ˜¯å¦ä¼šè¢« thrown awayï¼Œå®ƒä¸ä¼šè¢«è°ƒç”¨çš„ã€‚)</p>
<h2 id="state"><a href="#state" aria-label="state permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>State</h2>
<p>æˆ‘ä»¬<a href="#reconciliation">ä¹‹å‰</a>è®¨è®ºäº† identityï¼Œä»¥åŠ element åœ¨æ ‘ä¸­çš„æ¦‚å¿µâ€œä½ç½®â€å¦‚ä½•å‘Šè¯‰ React æ˜¯å¦åº”è¯¥é‡ç”¨å½“å‰ host instance è¿˜æ˜¯åˆ›å»ºæ–°çš„ã€‚Host instances æ‹¥æœ‰æ‰€æœ‰çš„æœ¬åœ°çŠ¶æ€ï¼šfocus, selection, input ç­‰ç­‰ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨é‚£äº›åœ¨æ¦‚å¿µä¸Šæ¸²æŸ“çš„æ˜¯ç›¸åŒ UI çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä¿ç•™è¿™äº›çŠ¶æ€ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›åœ¨æ¸²æŸ“æ¦‚å¿µä¸Šä¸åŒçš„ä¸œè¥¿æ—¶ï¼Œèƒ½å¤Ÿé¢„æµ‹åˆ°ç»„ä»¶ä¼šè¢«é”€æ¯ï¼ˆæ¯”å¦‚ä» <code class="language-text">SignupForm&gt;</code> ç§»åŠ¨åˆ° <code class="language-text">&lt;MessengerChat&gt;</code>ï¼‰ã€‚</p>
<p><strong>æœ¬åœ°çŠ¶æ€ï¼ˆLocal stateï¼‰æ˜¯å¦‚æ­¤æœ‰ç”¨ä»¥è‡³äº React è®© <em>ä½ è‡ªå·±</em> çš„ç»„ä»¶ä¹Ÿèƒ½æ‹¥æœ‰å®ƒã€‚</strong> Components ä¾ç„¶æ˜¯å‡½æ•°ï¼Œä½† React ä¸ºå®ƒä»¬æ‰©å……äº†ä¸€äº›å¯¹ UI æœ‰ç”¨çš„ç‰¹æ€§ï¼Œç»‘å®šåˆ°æ ‘ä¸­ç‰¹å®šä½ç½®çš„æœ¬åœ°çŠ¶æ€å°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„ç‰¹æ€§ä¹‹ä¸€ã€‚</p>
<p>æˆ‘ä»¬ç§°è¿™ä¸ªç‰¹æ€§ä¸º <em>Hooks</em>ã€‚<code class="language-text">useState</code> å°±æ˜¯ä¸€ä¸ª Hook ã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="gatsby-highlight-code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å®ƒè¿”å›ä¸€å¯¹å€¼ï¼šå½“å‰çš„çŠ¶æ€å’Œä¸€ä¸ªæ›´æ–°è¿™ä¸ªçŠ¶æ€çš„å‡½æ•°ã€‚</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring">array destructuring</a> è¯­æ³•è®©ä½ èƒ½å¤Ÿè‡ªå·±ä¸ºçŠ¶æ€å–ä¸€ä¸ªæ½‡æ´’çš„åå­—ã€‚æ¯”å¦‚ä¸Šé¢æˆ‘ä»¬å–åä¸º <code class="language-text">count</code> å’Œ <code class="language-text">setCount</code>ï¼Œå½“å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥å«å®ƒ <code class="language-text">banana</code> å’Œ <code class="language-text">setBanana</code>ã€‚åœ¨åæ–‡ï¼Œæˆ‘å°†ä¼šä½¿ç”¨ <code class="language-text">setState</code> æ¥å–ä»£ <code class="language-text">useState</code> è¿”å›çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚
<em>(ä½ å¯ä»¥åœ¨<a href="https://reactjs.org/docs/hooks-intro.html">è¿™é‡Œ</a> å­¦åˆ°å…³äº <code class="language-text">useState</code> å’Œ React æä¾›çš„å…¶ä»– hooks)</em></p>
<h2 id="consistency"><a href="#consistency" aria-label="consistency permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consistency</h2>
<p>å³ä½¿æˆ‘ä»¬æƒ³è¦å°† reconciliation è¿‡ç¨‹æ‹†åˆ†ä¸º<a href="https://www.youtube.com/watch?v=mDdgfyRB5kg">éå µå¡</a>çš„å·¥ä½œå—ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ perform the actual host tree operations in a single synchronous swoopã€‚è¿™æ ·æˆ‘ä»¬èƒ½ç¡®å®šç”¨æˆ·ä¸ä¼šçœ‹åˆ°æ›´æ–°åˆ°ä¸€åŠçš„ UIï¼Œæµè§ˆå™¨ä¹Ÿä¸ä¼šä¸ºäº†ç”¨æˆ·ä¸åº”è¯¥çœ‹åˆ°çš„ä¸­é—´çŠ¶æ€è€Œæ‰§è¡Œä¸å¿…è¦çš„ style recalculation å’Œ layoutï¼ˆè¯‘è€…æ³¨ï¼šæˆ–è€…å« reflowï¼Œå›æµï¼‰ã€‚</p>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React å°†å·¥ä½œåˆ†ä¸º <code class="language-text">render é˜¶æ®µ</code> å’Œ <code class="language-text">commit é˜¶æ®µ</code>ã€‚<strong>Render é˜¶æ®µ* æ˜¯ React è°ƒç”¨ç»„ä»¶å’Œæ‰§è¡Œ reconciliation çš„æ—¶æœºï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä½ å¯ä»¥å®‰å…¨çš„ä¸­æ–­å®ƒï¼ˆè¯‘è€…æ³¨ï¼šä¹Ÿå°±è¦æ±‚ component å¿…é¡»æ˜¯çº¯çš„ï¼Œå¹¶ä¸” will ç±»ç”Ÿå‘½å‘¨æœŸä¹Ÿæ˜¯å­˜çš„ï¼‰ï¼Œå¹¶ä¸”åœ¨å¯ä»¥æœŸå¾…çš„<a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">æœªæ¥</a>å°†æ”¯æŒå¼‚æ­¥æ¸²æŸ“ã€‚</strong>Commit é˜¶æ®µ** åˆ™æ˜¯ React æ¥è§¦åˆ° host tree çš„æ—¶æœºã€‚å®ƒæ€»æ˜¯åŒæ­¥çš„.</p>
<h2 id="memoization"><a href="#memoization" aria-label="memoization permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Memoization</h2>
<p>å½“çˆ¶ç»„ä»¶é€šè¿‡ <code class="language-text">setState</code> è°ƒåº¦ä¸€ä¸ªæ›´æ–°æ—¶ï¼ŒReact é»˜è®¤ä¼š reconciles å®ƒæ•´ä¸ªå­æ ‘ã€‚è¿™æ˜¯å› ä¸º React ä¸çŸ¥é“è¿™ä¸ªæ¥è‡ªçˆ¶ç»„ä»¶çš„æ›´æ–°æ˜¯å¦ä¼šå½±å“åˆ°å®ƒçš„ childï¼ŒReact é€‰æ‹©ä¿æŒä¸€è‡´ã€‚è¿™çœ‹ä¸Šå»ä¼šè®©æ¯æ¬¡æ›´æ–°çš„ä»£ä»·å¾ˆé«˜ï¼Œä¸è¿‡åœ¨å®é™…æƒ…å†µä¸‹ï¼Œé’ˆå¯¹ä¸­å°å‹è§„æ¨¡çš„å­æ ‘æ¥è¯´è¿™ä¸æ˜¯é—®é¢˜ã€‚</p>
<p>ä¸è¿‡å¦‚æœ tree å®åœ¨å¤ªæ·±æˆ–è€…å¤ªå¹¿ï¼ˆè¯‘è€…æ³¨ï¼šå…„å¼ŸèŠ‚ç‚¹å¤ªå¤šï¼‰çš„è¯ï¼Œä½ å¯ä»¥å‘Šè¯‰ React å» <a href="https://en.wikipedia.org/wiki/Memoization">memoize</a> å®ƒçš„å­æ ‘ï¼Œå¹¶åœ¨æ¯æ¬¡ props æ”¹å˜çš„æ—¶å€™ï¼Œé€šè¿‡æµ…æ¯”è¾ƒæ¥å†³å®šæ˜¯å¦é‡ç”¨ä¹‹å‰çš„æ¸²æŸ“ç»“æœã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Row</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> item <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Row<span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>ç°åœ¨åœ¨ <code class="language-text">Table</code> ä¸­ <code class="language-text">setState</code> æ—¶ï¼Œå°†ä¼šè·³è¿‡ reconciliation é‚£äº› <code class="language-text">items</code> çš„å¼•ç”¨å’Œä¸Šæ¬¡æ¸²æŸ“çš„ <code class="language-text">items</code> ç›¸åŒçš„ <code class="language-text">Row</code>ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <a href="https://reactjs.org/docs/hooks-reference.html#usememo"><code class="language-text">useMemo()</code> Hook</a> å¾—åˆ°ç»†ç²’åº¦çš„ memoizationã€‚The cache is local to component tree position å¹¶ä¸”å°†ä¼šå’Œæœ¬åœ°çŠ¶æ€ä¸€åŒè¢«é”€æ¯ã€‚å®ƒåªä¿ç•™ä¸Šä¸€ä¸ªç»“æœã€‚</p>
<p>React å†…éƒ¨é»˜è®¤ä¸ä¼š memoize ç»„ä»¶ï¼Œå› ä¸ºè®¸å¤šç»„ä»¶æ¯æ¬¡æ›´æ–°éƒ½ä¼šæ¥å—åˆ°ä¸åŒçš„ propsï¼Œè¿™æ ·çš„è¯å» memoize å°±æ˜¯ä¸€ç§æµªè´¹ã€‚ï¼ˆè¯‘è€…æ³¨ï¼šå¾ˆå¤šç»„ä»¶è®¾è®¡æˆæŸä¸ª props æ¥å—ä¸€ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯åœ¨ä¼ é€’çš„æ—¶å€™ ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æ˜¯å­—é¢é‡çš„è¯ï¼Œé‚£å°±ç­‰äºæ¯æ¬¡ props éƒ½å’Œä¸Šæ¬¡ä¸åŒäº†ã€‚ï¼‰</p>
<h2 id="raw-models"><a href="#raw-models" aria-label="raw models permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Raw Models</h2>
<p>è®½åˆºçš„æ˜¯ï¼ŒReact å¹¶æ²¡æœ‰ä½¿ç”¨ â€œå“åº”å¼â€ ç³»ç»Ÿè¿›è¡Œç»†ç²’åº¦æ›´æ–°ã€‚æ¢å¥è¯è¯´ï¼Œé¡¶éƒ¨çš„ä»»ä½•æ›´æ–°éƒ½ä¼šè§¦å‘ reconciliationï¼Œè€Œä¸æ˜¯ä»…æ›´æ–°å—å½±å“çš„ componentã€‚</p>
<p>è¿™å…¶å®æ˜¯ä¸€ä¸ªå†…éƒ¨è®¾è®¡çš„æŠ‰æ‹©ã€‚<a href="https://calibreapp.com/blog/time-to-interactive/">Time to Interactive</a> åœ¨ C ç«¯ Web App æ€§èƒ½åŸºå‡†ä¸­ï¼Œæ‰®æ¼”äº†ä¸€ä¸ªåŠå…¶å…³é”®çš„è§’è‰²ï¼Œéå†æ•´ä¸ªæ¨¡å‹å¹¶è®¾ç½®ç»†ç²’åº¦çš„æ›´æ–°å°†ä¼šèŠ±è´¹å®è´µçš„æ—¶é—´ã€‚å¦å¤–ï¼Œåœ¨è®¸å¤šåº”ç”¨ä¸­ï¼Œäº¤äº’å¾€å¾€ä¼šå¯¼è‡´å°å‹ï¼ˆbutton hoverï¼‰æˆ–è€…å¤§å‹ï¼ˆpage transitionï¼‰çš„æ›´æ–°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»†ç²’åº¦è®¢é˜…å¾€å¾€ä¼šæ¶ˆè€—æ›´å¤šå†…å­˜ã€‚</p>
<p>React æ ¸å¿ƒè®¾è®¡åŸåˆ™ä¹‹ä¸€æ˜¯å®ƒå¯ä»¥å¤„ç†åŸå§‹æ•°æ®ï¼ˆraw dataï¼‰ã€‚å¦‚æœä½ ä»ç½‘ç»œä¸­æ¥å—åˆ°äº†å¤§é‡çš„ JS å¯¹è±¡ï¼Œä½ å¯ä»¥ç›´æ¥å°†å®ƒä»¬å¡è¿› component ä¸­è€Œä¸éœ€è¦åšä»»ä½•é¢„å¤„ç†ã€‚ä½ å¯ä»¥éšæ„è¯»å–ä»»ä½•å±æ€§ï¼Œä¹Ÿä¸ä¼šåœ¨ç»“æ„è½»å¾®å˜åŠ¨çš„æ—¶å€™å‡ºç°æ„æƒ³ä¸åˆ°çš„æ€§èƒ½æŠ–åŠ¨ã€‚React æ¸²æŸ“æ—¶é—´å¤æ‚åº¦æ˜¯ O(<em>view size</em>) è€Œä¸æ˜¯ O(<em>model size</em>)ï¼Œä½ å¯ä»¥é€šè¿‡ <a href="https://react-window.now.sh/#/examples/list/fixed-size">windowing</a> æ¥æ˜¾è‘—åœ°é™ä½ <em>view size</em> çš„å€¼ã€‚</p>
<p>ä¸€äº›ç‰¹å®šç±»å‹çš„ app é‡‡ç”¨ç»†ç²’åº¦çš„æ›´æ–°ä¼šæœ‰æ›´å¥½çš„æ•ˆæœâ€”æ¯”å¦‚è‚¡ç¥¨è·Ÿè¸ªè½¯ä»¶ã€‚è¿™æ˜¯å°‘æœ‰çš„ â€œeverything constantly updating at the same timeâ€ çš„ä¾‹å­ã€‚å°½ç®¡è‡ªå·±å†™ä¸€äº›å‘½ä»¤å¼çš„ä»£ç èƒ½å¤Ÿä¼˜åŒ–ï¼ŒReact åœ¨è¿™ç§ä½¿ç”¨åœºæ™¯ä¸Šå¹¶ä¸æ˜¯æœ€é€‚åˆçš„ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨ React çš„ä¸Šå±‚å®ç°ä¸€å¥—è‡ªå·±çš„ç»†ç²’åº¦è®¢é˜…ç³»ç»Ÿã€‚</p>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰ä¸€äº›é€šç”¨çš„æ€§èƒ½é—®é¢˜ï¼Œå³ä½¿æ˜¯ç»†ç²’åº¦è®¢é˜…å’Œâ€œå“åº”å¼â€ç³»ç»Ÿä¹Ÿä¸èƒ½è§£å†³ã€‚</strong> ä¸¾ä¸ªä¾‹å­ï¼Œæ¸²æŸ“ä¸€ä¸ªæ–°çš„ deep treeï¼ˆæ¯æ¬¡ page transition çš„æ—¶å€™å‘ç”Ÿï¼‰è€Œä¸å µå¡æµè§ˆå™¨ã€‚æ”¹å˜ tracking å¹¶ä¸ä¼šè®©å®ƒæ›´å¿«â€”å› ä¸ºå®ƒéœ€è¦åœ¨è®¢é˜…ä¸Šåšæ›´å¤šå·¥ä½œä»è€Œå˜æ…¢äº†ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬åœ¨æ¸²æŸ“è§†å›¾ä¹‹å‰å¿…é¡»ç­‰å¾…æ•°æ®çš„åˆ°æ¥ã€‚åœ¨ React ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ <a href="https://reactjs.org/blog/2018/03/01/sneak-peek-beyond-react-16.html">Concurrent Rendering</a> æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 id="batching"><a href="#batching" aria-label="batching permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Batching</h2>
<p>å¯èƒ½æœ‰å‡ ä¸ªç»„ä»¶ä¼šå¸Œæœ›åœ¨åŒä¸€ä¸ªäº‹ä»¶ä¸­ä¸€èµ·æ›´æ–°çŠ¶æ€ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­è™½ç„¶é”™ç»¼å¤æ‚ä½†æ˜¯å®ƒè¯´æ˜äº†ä¸€ä¸ªé€šç”¨çš„æ¨¡å¼ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      Parent clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
<span class="gatsby-highlight-code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span></span><span class="token plain-text">      Child clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å½“ä¸€ä¸ªäº‹ä»¶è¢« dispatchedï¼Œå­èŠ‚ç‚¹çš„ <code class="language-text">onClick</code> å…ˆè°ƒç”¨ï¼ˆè§¦å‘å®ƒçš„ <code class="language-text">setState</code>ï¼‰ï¼Œæ¥ç€å®ƒçš„çˆ¶ç»„ä»¶ä¹Ÿè°ƒç”¨åœ¨å®ƒè‡ªå·±çš„ <code class="language-text">onClick</code> handler ä¸­è°ƒç”¨ <code class="language-text">setState</code>ã€‚</p>
<p>å¦‚æœ React åœ¨ <code class="language-text">setState</code> åç«‹åˆ»é‡æ–°æ¸²æŸ“ component çš„è¯ï¼Œæˆ‘ä»¬ä¼šä¼´éšç€ child è¢«æ¸²æŸ“ä¸¤æ¬¡è€Œç»“æŸã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token operator">**</span><span class="token operator">*</span> Entering React's browser click event handler <span class="token operator">**</span><span class="token operator">*</span>
<span class="token function">Child</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
<span class="gatsby-highlight-code-line">  <span class="token operator">-</span> re<span class="token operator">-</span>render Child <span class="token comment">// ğŸ˜ unnecessary</span></span><span class="token function">Parent</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
  <span class="token operator">-</span> re<span class="token operator">-</span>render Parent
<span class="gatsby-highlight-code-line">  <span class="token operator">-</span> re<span class="token operator">-</span>render Child</span><span class="token operator">**</span><span class="token operator">*</span> Exiting React's browser click event handler <span class="token operator">**</span><span class="token operator">*</span></code></pre></div>
<p>ç¬¬ä¸€æ¬¡ <code class="language-text">Child</code> çš„æ¸²æŸ“è¢«æµªè´¹äº†ï¼Œè€Œä¸”æˆ‘ä»¬ä¸èƒ½è®© React åœ¨ç¬¬äºŒæ¬¡æ›´æ–°çš„æ—¶å€™è·³è¿‡æ¸²æŸ“ <code class="language-text">Child</code>ï¼Œå› ä¸º <code class="language-text">Parent</code> å¯èƒ½ä¼šä¼ é€’ä¸€äº›åŸºäºè‡ªå·±æœ€æ–°çš„ state çš„å¤æ‚æ•°æ®ç»™ <code class="language-text">Child</code>ã€‚</p>
<p><strong>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ React ä¼šåœ¨ event handlers ä¸­æ‰¹é‡æ›´æ–°ï¼š</strong></p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token operator">**</span><span class="token operator">*</span> Entering React's browser click event handler <span class="token operator">**</span><span class="token operator">*</span>
<span class="token function">Child</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
<span class="token function">Parent</span> <span class="token punctuation">(</span>onClick<span class="token punctuation">)</span>
  <span class="token operator">-</span> setState
<span class="token operator">**</span><span class="token operator">*</span> Processing state updates                     <span class="token operator">**</span><span class="token operator">*</span>
  <span class="token operator">-</span> re<span class="token operator">-</span>render Parent
  <span class="token operator">-</span> re<span class="token operator">-</span>render Child
<span class="token operator">**</span><span class="token operator">*</span> Exiting React's browser click event handler  <span class="token operator">**</span><span class="token operator">*</span></code></pre></div>
<p>åœ¨ç»„ä»¶ä¸­è°ƒç”¨ <code class="language-text">setState</code> ä¸ä¼šç«‹åˆ»é‡æ–°æ¸²æŸ“ï¼Œç›¸åï¼ŒReact ä¼šå…ˆæ‰§è¡Œæ‰€æœ‰çš„ event handlersã€‚ç„¶åä¼šé‡æ–°æ¸²æŸ“ä¸€æ¬¡æ¥å°†è¿™æ‰€æœ‰çš„æ›´æ–°ä¸€æ¬¡æå®šã€‚ï¼ˆè¯‘è€…æ³¨ï¼šReact 16 ä¸­ï¼Œæ— æ³•æ‰¹å¤„ç† <code class="language-text">Promise</code> å’Œ <code class="language-text">setTimeout</code> ä¸­çš„ <code class="language-text">setState</code>ï¼‰</p>
<p>æ‰¹å¤„ç†å¯¹æ€§èƒ½å¾ˆå‹å¥½ï¼Œä½†æ˜¯ä¼šè®©å†™å‡ºä¸‹é¢è¿™æ ·çš„ä»£ç çš„ä½ å¾ˆæƒŠè®¶ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setCounter</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœæˆ‘ä»¬å°† <code class="language-text">count</code> å…ˆè®¾ç½®ä¸º <code class="language-text">0</code>ï¼Œæ¥ç€è°ƒç”¨ 3 æ¬¡ <code class="language-text">setCount(1)</code>ã€‚ä¸ºäº†ä¿®å¤è¿™ä¸ªï¼Œæˆ‘ä»¬éœ€è¦è®© <code class="language-text">setState</code> æ¥å—ä¸€ä¸ª â€œupdaterâ€ å‡½æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setCounter</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>React å°†æ‰€æœ‰çš„ updater å‡½æ•°æ”¾è¿›é˜Ÿåˆ—ä¸­ï¼Œä¹‹åä¼šä¸€æ¬¡æ€§å°†å®ƒä»¬å…¨éƒ¨è¿è¡Œï¼Œå°† <code class="language-text">count</code> è®¾ä¸º <code class="language-text">3</code> å¹¶é‡æ–°æ¸²æŸ“ã€‚
React would put the updater functions in a queue, and later run them in sequence, resulting in a re-render with <code class="language-text">count</code> set to <code class="language-text">3</code>.</p>
<p>å½“çŠ¶æ€é€»è¾‘è¶Šæ¥è¶Šå¤æ‚åï¼Œæˆ‘å»ºè®®ä½¿ç”¨ <a href="https://reactjs.org/docs/hooks-reference.html#usereducer"><code class="language-text">useReducer</code> Hook</a>ã€‚å®ƒå°±åƒæ˜¯è¿™ä¸ª â€œupdaterâ€ æ¨¡å¼çš„è¿›åŒ–ï¼Œå¹¶ç»™æ¯ä¸€ç§æ›´æ–°é€”å¾„å‘½äº†åï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action <span class="token operator">===</span> <span class="token string">'increment'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å®å‚ <code class="language-text">action</code> å¯ä»¥éšä¾¿è®¾ï¼Œå½“ç„¶ object æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<h2 id="call-tree"><a href="#call-tree" aria-label="call tree permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Call Tree</h2>
<p>ç¼–ç¨‹è¯­è¨€çš„ runtime é€šå¸¸éƒ½æœ‰ <a href="https://medium.freecodecamp.org/understanding-the-javascript-call-stack-861e41ae61d4">call stack</a>ã€‚å½“å‡½æ•° <code class="language-text">a()</code> è°ƒç”¨ä¸€ä¸ªå‡½æ•° <code class="language-text">b()</code>ï¼Œè€Œ b åˆè°ƒç”¨äº† <code class="language-text">c()</code>ï¼Œåœ¨ JS å¼•æ“çš„æŸä¸ªåœ°æ–¹ä¼šä¸ºå®ƒæ„é€ ä¸€ä¸ªç±»ä¼¼äº <code class="language-text">[a, b, c]</code> è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œå®ƒâ€œè·Ÿè¸ªâ€ä½ çš„ä½ç½®å’Œæ¥ä¸‹æ¥è¦æ‰§è¡Œçš„ä»£ç ã€‚ä¸€æ—¦ <code class="language-text">c</code> è¿è¡Œç»“æŸï¼Œå®ƒçš„ call frame å°±ä¼šæ¶ˆå¤±äº†ï¼Œå®ƒä¸å†è¢«éœ€è¦ã€‚æˆ‘ä»¬è·³å›åˆ° <code class="language-text">b</code>ï¼Œæ¥ç€æ˜¯ <code class="language-text">a</code>ï¼Œè¿™æ—¶ call stack å°±æ˜¯ç©ºçš„äº†ã€‚</p>
<p>å½“ç„¶ï¼ŒReact å®ƒæ˜¯åŸºäº JS çš„ï¼Œå®ƒä¹Ÿè¦éµå®ˆ JS çš„è§„åˆ™ã€‚æˆ‘ä»¬å¯ä»¥æƒ³è±¡ React å†…éƒ¨ä¹Ÿæœ‰è‡ªå·±çš„ call stack ç”¨æ¥è®°ä½å½“å‰æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶ã€‚æ¯”å¦‚ï¼š<code class="language-text">[App, Page, Layout, Article /* we&#39;re here */]</code>ã€‚</p>
<p>å› ä¸º React å®ƒæ—¨åœ¨å‘ˆç° UI treesï¼Œæ‰€ä»¥å®ƒå’Œé€šç”¨è¯­è¨€çš„ run time ä¸å¤ªç›¸åŒã€‚è¿™äº›æ ‘å¿…é¡»è¦ä¸€ç›´å­˜åœ¨ä»¥è®©æˆ‘ä»¬èƒ½å’Œå®ƒä»¬äº¤äº’ã€‚DOM ä¹Ÿä¸ä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ <code class="language-text">ReactDOM.render()</code> åæ¶ˆå¤±ã€‚</p>
<p>è¿™å¯èƒ½å¤¸å¤§äº†è¿™ä¸ªæ¯”å–»ï¼Œä½†æˆ‘å–œæ¬¢å°† React components è§†ä¸º â€œcall treeâ€ è€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ª â€call stackâ€ã€‚å½“æˆ‘ä»¬ä» <code class="language-text">Article</code> component ä¸­é€€å‡ºæ—¶ï¼Œå®ƒçš„ â€call treeâ€ ä¸ä¼šè¢«é”€æ¯ã€‚æˆ‘ä»¬éœ€è¦åœ¨<a href="https://medium.com/react-in-depth/the-how-and-why-on-reacts-usage-of-linked-list-in-fiber-67f1014d0eb7">æŸä¸ªåœ°æ–¹</a>ä¿ç•™æœ¬åœ°çŠ¶æ€å’Œå¯¹ host instance çš„å¼•ç”¨ã€‚</p>
<p>è¿™äº› â€œcall treeâ€ frames ä¼šåœ¨è¢«æ‘§æ¯çš„åŒæ—¶å¸¦èµ°ä¿å­˜çš„æœ¬åœ°çŠ¶æ€å’Œ host instancesï¼Œä½†è¿™ä»…ä»…åœ¨ <a href="#reconciliation">reconciliation</a> ä¸­æ‰æœ‰å¯èƒ½å‘ç”Ÿã€‚å¦‚æœä½ ä¹‹å‰çœ‹è¿‡ React æºç ï¼Œä½ å¯èƒ½çŸ¥é“è¿™äº› frame è¢«ç§°ä¹‹ä¸º <a href="https://en.wikipedia.org/wiki/Fiber_(computer_science)">Fibers</a>ã€‚</p>
<p>Fiber å°±æ˜¯æœ¬åœ°çŠ¶æ€å®é™…å­˜åœ¨çš„åœ°æ–¹ã€‚å½“çŠ¶æ€æ›´æ–°æ—¶ï¼ŒReact ä¼šå°†è¿™äº› Fibers æ ‡è®°ä¸ºéœ€è¦ reconciliationï¼Œå¹¶è°ƒç”¨è¿™äº›ç»„ä»¶ã€‚</p>
<h2 id="context"><a href="#context" aria-label="context permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Context</h2>
<p>åœ¨ React ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ props åœ¨ç»„ä»¶ä¹‹é—´ä¸€å±‚ä¸€å±‚åœ°ä¼ é€’ thingsã€‚æœ‰æ—¶ï¼Œå¤§é‡çš„ç»„ä»¶éœ€è¦åŒæ ·çš„ thingâ€”æ¯”å¦‚ï¼Œå½“å‰ç”¨æˆ·é€‰ä¸­çš„ä¸»é¢˜ã€‚å¦‚æœä¸€çº§ä¸€çº§åœ°å¾€ä¸‹ä¼ é€’çš„è¯ï¼Œå®åœ¨å¤ªç¬¨é‡äº†ã€‚</p>
<p>React ä½¿ç”¨ <a href="https://reactjs.org/docs/context.html">Context</a> è§£å†³è¿™ä¸ªé—®é¢˜,å®ƒæœ¬è´¨ä¸Šå¾ˆåƒç»„ä»¶çš„ <a href="http://wiki.c2.com/?DynamicScoping">dynamic scoping</a>ã€‚å®ƒå°±åƒä¸€ä¸ªè™«æ´ä¸€æ ·ï¼Œè®©ä½ å°†ä¸€äº›ä¸œè¥¿æ”¾åœ¨é¡¶éƒ¨ï¼Œè€Œæ¯ä¸€ä¸ªåœ¨åº•éƒ¨çš„å­èŠ‚ç‚¹éƒ½èƒ½å»å¤ºå–å®ƒï¼Œå¹¶åœ¨å®ƒæ”¹å˜çš„æ—¶å€™é‡æ–°æ¸²æŸ“ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>
  <span class="token string">'light'</span> <span class="token comment">// Default value as a fallback</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">DarkApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ThemeContext.Provider</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyComponents</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ThemeContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">SomeDeeplyNestedChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Depends on where the child is rendered</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å½“ <code class="language-text">SomeDeeplyNestedChild</code> æ¸²æŸ“æ—¶ï¼Œ<code class="language-text">useContext(ThemeContext)</code> å°†ä¼šå‘ä¸Šå»å¯»æ‰¾æœ€è¿‘çš„ <code class="language-text">&lt;ThemeContext.Provider&gt;</code>ï¼Œå¹¶ä½¿ç”¨å®ƒçš„ <code class="language-text">value</code>ã€‚ï¼ˆå®é™…ä¸Šï¼ŒReact è¿˜ç»´æŠ¤äº†ä¸€ä¸ª context stackï¼‰</p>
<p>å¦‚æœæ²¡æœ‰ <code class="language-text">ThemeContext.Provider</code> å­˜åœ¨ï¼Œ<code class="language-text">useContext(ThemeContext)</code> çš„ç»“æœå°±æ˜¯è°ƒç”¨ <code class="language-text">createContext()</code> æ—¶åœ¨ç¬¬ä¸€ä¸ªå‚æ•°é‡Œä¼ é€’çš„å€¼ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯ <code class="language-text">&#39;light&#39;</code>ã€‚</p>
<h2 id="effects"><a href="#effects" aria-label="effects permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Effects</h2>
<p>æˆ‘ä»¬ä¹‹å‰æåˆ° React component ä¸åº”è¯¥åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œæœ‰å‰¯ä½œç”¨ï¼Œä½†æ˜¯å‰¯ä½œç”¨åœ¨æŸäº›æƒ…å†µä¸‹ç¡®å®å¾ˆæœ‰å¿…è¦ã€‚æˆ‘ä»¬ç»å¸¸éœ€è¦ç®¡ç† focusï¼Œåœ¨ canvas ä¸Šç”»å›¾ï¼Œè®¢é˜…ä¸€ä¸ªæ•°æ®æºç­‰ç­‰ã€‚</p>
<p>React é€šè¿‡å£°æ˜ä¸€ä¸ª effect æ¥å®ç°å®ƒï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="gatsby-highlight-code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Click me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åªè¦å¯èƒ½ï¼ŒReact ä¼šåœ¨æµè§ˆå™¨é‡ç»˜å±å¹•ä¹‹å‰å°½å¯èƒ½çš„å»¶è¿Ÿè¿è¡Œè¿™äº› effectsã€‚è¿™å¾ˆæ£’ï¼Œå› ä¸ºç±»ä¼¼äºæ•°æ®æºè®¢é˜…çš„è¿™äº›ä»£ç ä¸åº”è¯¥å¯¹ <a href="https://calibreapp.com/blog/time-to-interactive/">time to interactive</a> å’Œ <a href="https://developers.google.com/web/tools/lighthouse/audits/first-meaningful-paint">time to first paint</a> æœ‰è´Ÿé¢å½±å“ã€‚ï¼ˆè¿™æœ‰ä¸€ä¸ªæå°‘ä½¿ç”¨çš„ <a href="https://reactjs.org/docs/hooks-reference.html#uselayouteffect">hook</a> ç»™ä½ æä¾›åŒæ­¥è°ƒç”¨ effect çš„è¡Œä¸ºã€‚å°½é‡åˆ«ç”¨å®ƒï¼‰</p>
<p>Effect ä¸ä¼šè‡ªè¿è¡Œä¸€æ¬¡ï¼Œå®ƒä»¬æ—¢åœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™ä¼šè¿è¡Œï¼Œä¹Ÿåœ¨ç»„ä»¶æ›´æ–°çš„æ—¶å€™è¿è¡Œã€‚</p>
<p>Effects æœ‰äº›æ—¶å€™éœ€è¦ä¸€èµ·æ¸…ç†æ“ä½œï¼Œæ¯”å¦‚è®¢é˜…çš„åœºæ™¯ã€‚ä¸ºäº†æ¸…ç†å®ƒä»¬ï¼Œeffect å¯ä»¥è¿”å›ä¸€ä¸ªå‡½æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  DataSource<span class="token punctuation">.</span><span class="token function">addSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> DataSource<span class="token punctuation">.</span><span class="token function">removeSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>React å°†ä¼šåœ¨ä¸‹æ¬¡åº”ç”¨ effect ä¹‹å‰æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå½“ç„¶ç»„ä»¶æ‘§æ¯ä¹‹å‰ä¹Ÿä¼šæ‰§è¡Œã€‚</p>
<p>æœ‰äº›æ—¶å€™ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è¿è¡Œ effect ä¸è®©äººæ¥å—ã€‚ä½ å¯ä»¥å‘Šè¯‰ Reactï¼Œå¦‚æœå½“å‰å˜é‡æ²¡æœ‰æ”¹å˜çš„è¯ï¼Œ<a href="https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects">è·³è¿‡</a> è¿™æ¬¡ effect çš„è¿è¡Œã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token string">`You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times`</span></span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>count<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ç„¶åï¼Œè¿™é€šå¸¸æ˜¯ä¸€ä¸ªè¿‡æ—©ä¼˜åŒ–ï¼Œå¹¶åœ¨ä½ ä¸ç†Ÿæ‚‰ JS é—­åŒ…çš„åŸç†ä¸‹ä¼šå¯¼è‡´é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä»£ç å°±æœ‰ bugï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  DataSource<span class="token punctuation">.</span><span class="token function">addSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> DataSource<span class="token punctuation">.</span><span class="token function">removeSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å› ä¸º <code class="language-text">[]</code> ç›¸å½“äºå‘Šè¯‰ React â€æ°¸è¿œä¸è¦é‡æ–°è°ƒç”¨è¿™ä¸ª effectâ€ï¼Œè¿™å°±å¯¼è‡´äº† bugã€‚å› ä¸ºè¿™ä¸ª effect çš„é—­åŒ…æ•è·äº† <code class="language-text">handleChange</code>ï¼Œè€Œ <code class="language-text">handleChange</code> å¯èƒ½ä¼šå¼•ç”¨å…¶ä»–çš„ props æˆ–è€… stateã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">handleChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœ effect æ²¡æœ‰é‡æ–°è¿è¡Œçš„è¯ï¼Œ<code class="language-text">handleChange</code> å°†ä¼šä¿æŒç¬¬ä¸€æ¬¡æ¸²æŸ“çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œå› æ­¤ <code class="language-text">count</code> å°†æ°¸è¿œéƒ½æ˜¯ 0.</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¡®ä¿ä½ å£°æ˜çš„ä¾èµ–æ•°ç»„ä¸­ï¼ŒåŒ…å«äº†<strong>æ‰€æœ‰</strong>å¯èƒ½ä¼šæ”¹å˜çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬å‡½æ•°ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token function">useEffect</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    DataSource<span class="token punctuation">.</span><span class="token function">addSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="gatsby-highlight-code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> DataSource<span class="token punctuation">.</span><span class="token function">removeSubscription</span><span class="token punctuation">(</span>handleChange<span class="token punctuation">)</span><span class="token punctuation">;</span></span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>handleChange<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>æ ¹æ®ä½ çš„ä»£ç è€Œå®šï¼Œè¿™é‡Œè¿˜ä¼šå‡ºç°ä¸å¿…è¦çš„é‡è®¢é˜…ï¼Œå› ä¸º <code class="language-text">handleChange</code> åœ¨æ¯æ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½æ˜¯ä¸åŒçš„ã€‚ <a href="https://reactjs.org/docs/hooks-reference.html#usecallback"><code class="language-text">useCallback</code></a> å¯ä»¥å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ–è€…ä½ å°±è®©å®ƒé‡è®¢é˜…ï¼Œå› ä¸ºæµè§ˆå™¨ç¯å¢ƒçš„ <code class="language-text">addEventListener</code> éå¸¸å¿«ï¼Œè®©å®ƒè¿è¡Œé—®é¢˜ä¸å¤§ã€‚å› ä¸ºä¸€ä¸ªå°ä¼˜åŒ–å¯¼è‡´æ›´å¤šé—®é¢˜å¾—ä¸å¿å¤±ã€‚</p>
<p><em>ï¼ˆä½ å¯ä»¥åœ¨<a href="https://reactjs.org/docs/hooks-effect.html">è¿™é‡Œ</a>å­¦åˆ°æ›´å¤šå…³äº <code class="language-text">useEffect</code> å’Œå…¶ä»–å®˜æ–¹ Hookï¼‰</em></p>
<h2 id="custom-hooks"><a href="#custom-hooks" aria-label="custom hooks permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Hooks</h2>
<p>å› ä¸º <code class="language-text">useState</code> å’Œ <code class="language-text">useEffect</code> å…¶å®éƒ½æ˜¯å‡½æ•°è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬ç»„åˆåˆ°è‡ªå·±çš„ Hook ä¸­ï¼š</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">MyResponsiveComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> width <span class="token operator">=</span> <span class="token function">useWindowWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Our custom Hook</span></span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Window width is </span><span class="token punctuation">{</span>width<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="gatsby-highlight-code-line"><span class="token keyword">function</span> <span class="token function">useWindowWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>width<span class="token punctuation">,</span> setWidth<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleResize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setWidth</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> handleResize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> width<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è‡ªå®šä¹‰ï¼ˆCustom Hooksï¼‰å¯ä»¥è®©ä¸åŒçš„ç»„ä»¶æœç”¨é€»è¾‘ï¼Œæ³¨æ„<strong>çŠ¶æ€ æœ¬èº«</strong>æ˜¯ä¸å…±äº«çš„ã€‚æ¯ä¸€ä¸ªè°ƒç”¨ Hook çš„ç»„ä»¶éƒ½æ‹¥æœ‰å®ƒä»¬è‡ªå·±å•ç‹¬çš„çŠ¶æ€ã€‚
/ä½ å¯ä»¥åœ¨<a href="https://reactjs.org/docs/hooks-custom.html">è¿™é‡Œ</a>å­¦åˆ°æ›´å¤šè‡ªå®šä¹‰ Hooks çš„å†™æ³•/</p>
<h2 id="static-use-order"><a href="#static-use-order" aria-label="static use order permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Static Use Order</h2>
<p>ä½ å¯ä»¥è®¤ä¸º <code class="language-text">useState</code> æ˜¯ä¸€ä¸ªç”¨æ¥å®šä¹‰â€œReact çŠ¶æ€å˜é‡â€çš„è¯­æ³•ã€‚ä½†å®ƒæ¯•ç«Ÿä¸æ˜¯<strong>çœŸæ­£</strong>çš„è¯­æ³•ï¼Œæˆ‘ä»¬è¿˜æ˜¯åœ¨å†™ JSã€‚ä½†æˆ‘ä»¬å°† React è§†ä¸ºè¿è¡Œæ—¶ç¯å¢ƒï¼Œå¹¶ä¸”ç”±äº React å®šåˆ¶ JS æ¥æè¿° UI æ ‘ï¼Œå› æ­¤å…¶åŠŸèƒ½æœ‰æ—¶ä¼šæ›´æ¥è¿‘è¯­è¨€å±‚é¢ã€‚</p>
<p>å¦‚æœ <code class="language-text">use</code> <strong>æ˜¯</strong>ä¸€ä¸ªè¯­æ³•ï¼Œé‚£ä¹ˆå®ƒåœ¨é¡¶çº§ä½œç”¨åŸŸå°±æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>
<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ˜‰ Note: not a real syntax</span>
component <span class="token function">Example</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="gatsby-highlight-code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">You clicked </span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">        Click me</span>
<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"></span>
<span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æœå°†å®ƒæ”¾åœ¨ä¸€ä¸ªæ¡ä»¶è¯­æ³•æˆ–è€…å›è°ƒä¸­ï¼Œç”šè‡³æ”¾åœ¨ç»„ä»¶å¤–æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ˜‰ Note: not a real syntax</span>

<span class="token comment">// This is local state... of what?</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

component <span class="token function">Example</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// What happens to it when condition is false?</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// What happens to it when we leave a function?</span>
    <span class="token comment">// How is this different from a variable?</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>React state å¯¹äº <strong>component</strong> æ¥è¯´æ˜¯å±€éƒ¨çš„ï¼Œå¹¶ä¸”å®ƒåœ¨ç¯å¢ƒä¸­å…·æœ‰å”¯ä¸€æ€§ã€‚å¦‚æœ <code class="language-text">use</code> æ˜¯ä¸€ä¸ªçœŸå®çš„è¯­æ³•ï¼Œé‚£ä¹ˆå°†å®ƒæ‰©å±•åˆ° <strong>component</strong> çš„é¡¶å±‚ä¹Ÿæ˜¯æœ‰æ„ä¹‰çš„ï¼š</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// ğŸ˜‰ Note: not a real syntax</span>
component <span class="token function">Example</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Only valid here</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>condition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// This would be a syntax error</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> use <span class="token function">State</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span></code></pre></div>
<p>è¿™å’Œ <code class="language-text">import</code> åªèƒ½åœ¨é¡¶çº§ä½œç”¨åŸŸå·¥ä½œçš„æƒ…å½¢å¾ˆç±»ä¼¼ã€‚</p>
<p><em>å½“ç„¶ï¼Œ<code class="language-text">use</code> å¹¶ä¸æ˜¯çœŸæ­£çš„è¯­æ³•ã€‚</em>ï¼ˆå®ƒä¸ä¼šç»™ä½ å¸¦æ¥å¥½å¤„ï¼Œè¿˜å¸¦æ¥äº†å¾ˆå¤šé—®é¢˜ï¼‰</p>
<p>ä¸è¿‡ï¼ŒReact <strong>ç¡®å®</strong>æœŸæœ›æ‰€æœ‰å¯¹äº Hooks çš„è°ƒç”¨ï¼Œåœ¨å­˜åœ¨äº component å’Œ <code class="language-text">no-if</code> è¯­å¥ä¸­ã€‚è¿™äº› <a href="https://reactjs.org/docs/hooks-rules.html">Hooks çš„è§„åˆ™</a> å¯ä»¥é€šè¿‡ä¸€ä¸ª <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">a linter plugin</a> æ¥å¼ºåˆ¶æ‰§è¡Œã€‚å…³äºè¿™ä¸ªè®¾è®¡é€‰æ‹©çš„è®¨è®ºååˆ†æ¿€çƒˆï¼Œä½†æ˜¯å®é™…æˆ‘å¹¶æ²¡æœ‰çœ‹åˆ°å®ƒè®©äººæ„Ÿåˆ°å›°æƒ‘ã€‚æˆ‘ä¹Ÿå†™äº†<a href="https://overreacted.io/why-do-hooks-rely-on-call-order/">ä¸€ç¯‡æ–‡ç« </a>æ¥è§£é‡Šä¸ºä»€ä¹ˆä¸€äº›å¸¸è§çš„ææ¡ˆè¾¾ä¸åˆ°æ•ˆæœã€‚</p>
<p>åœ¨å†…éƒ¨ï¼ŒHooks ç”±ä¸€ä¸ª <a href="https://dev.to/aspittel/thank-u-next-an-introduction-to-linked-lists-4pph">é“¾è¡¨</a> å®ç°ã€‚å½“ä½ è°ƒç”¨ <code class="language-text">useState</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ª hookã€‚å½“æˆ‘ä»¬é€€å‡º component çš„ <a href="#call-tree">â€œcall treeâ€ frame</a>ï¼Œæˆ‘ä»¬ä¼šä¿å­˜è¿™ä¸ªç»“æœç›´åˆ°ä¸‹ä¸€æ¬¡ renderã€‚</p>
<p><a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">è¿™ç¯‡æ–‡ç« </a> é’ˆå¯¹ Hooks å†…éƒ¨å¦‚ä½•å·¥ä½œæä¾›äº†ä¸€ä¸ªç®€å•çš„è§£é‡Šã€‚æ•°ç»„å¯èƒ½æ¯”é“¾è¡¨åœ¨ç†è§£ä¸Šæ›´åŠ å®¹æ˜“äº›ã€‚</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// Pseudocode</span>
<span class="token keyword">let</span> hooks<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  i<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Next renders</span>
    <span class="token keyword">return</span> hooks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// First render</span>
  hooks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Prepare to render</span>
i <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
hooks <span class="token operator">=</span> fiber<span class="token punctuation">.</span>hooks <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Call the component</span>
<span class="token function">YourComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Remember the state of Hooks</span>
fiber<span class="token punctuation">.</span>hooks <span class="token operator">=</span> hooks<span class="token punctuation">;</span></code></pre></div>
<p>/ï¼ˆå¦‚æœä½ å¥½å¥‡çš„è¯ï¼Œä»£ç åœ¨<a href="https://github.com/facebook/react/blob/master/packages/react-reconciler/src/ReactFiberHooks.js">è¿™</a>ï¼‰/
è¿™æ˜¯æ¯ä¸€ä¸ª <code class="language-text">useState</code> è°ƒç”¨å¦‚ä½•æ‰¾åˆ°æ­£ç¡®çš„ state çš„ç²—ç•¥çš„ä»‹ç»ã€‚æ­£å¦‚æˆ‘ä»¬<a href="#reconciliation">ä¹‹å‰</a>å­¦åˆ°çš„ï¼Œâ€œmatching things upâ€ åœ¨ React ä¸­å¹¶ä¸æ˜¯æ–°é²œäº‹ â€” reconciliation ç”¨ç±»ä¼¼çš„æ–¹æ³•åœ¨ä¸åŒçš„æ¸²æŸ“ä¸­åŒ¹é… elementsã€‚</p>
<h2 id="whats-left-out"><a href="#whats-left-out" aria-label="whats left out permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Whatâ€™s Left Out</h2>
<p>Weâ€™ve touched on pretty much all important aspects of the React runtime environment. If you finished this page, you probably know React in more detail than 90% of its users. And thereâ€™s nothing wrong with that!</p>
<p>There are some parts I left out â€” mostly because theyâ€™re unclear even to us. React doesnâ€™t currently have a good story for multipass rendering, i.e. when the parent render needs information about the children. Also, the <a href="https://reactjs.org/docs/error-boundaries.html">error handling API</a> doesnâ€™t yet have a Hooks version. Itâ€™s possible that these two problems can be solved together. Concurrent Mode is not stable yet, and there are interesting questions about how Suspense fits into this picture. Maybe Iâ€™ll do a follow-up when theyâ€™re fleshed out and Suspense is ready for more than <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html#reactlazy-code-splitting-with-suspense">lazy loading</a>.</p>
<p>I think it speaks to the success of Reactâ€™s API that you can get very far without ever thinking about most of these topics. Good defaults like the reconciliation heuristics do the right thing in most cases. Warnings like the <code class="language-text">key</code> warning nudge you when you risk shooting yourself in the foot.</p>
<p>If youâ€™re a UI library nerd, I hope this post was somewhat entertaining and clarified how React works in more depth. Or maybe you decided React is too complicated and youâ€™ll never look it again. In either case, Iâ€™d love to hear from you on Twitter! Thank you for reading.</p></main><hr style="margin-bottom:1.75rem"/><footer><figure style="display:flex;align-items:center"><img src="/blogs/static/avatar-6c83ccb0db60a97539ade1fe12738717.jpg" alt="A cat named musa" style="margin-right:0.875rem;margin-bottom:0;border-radius:50%;width:3.5rem;height:3.5rem"/><aside class="sc-bwzfXH iJuWiM"><h3><span role="img" aria-label="personal blogs">ğŸ‘¤ ğŸ“œ</span> <!-- -->by <a href="http://github.com/thoamsy">thoamsy</a></h3><h3>Write some personal summary</h3></aside></figure><br/><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blogs/react-trap/">â† <!-- -->ä¸€äº› React ä¸­çš„åˆé’»é—®é¢˜</a></li><li><a rel="next" href="/blogs/division100/division100/">ä¸ºä»€ä¹ˆè¦é™¤ä»¥ 100?<!-- --> â†’</a></li></ul></footer></div></section></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"react-as-a-runtime-0a9","path":"/react-as-a-runtime/"};window.dataPath="699/path---react-as-a-runtime-0-a-9-d57-nXsEH9seJGbH7iwlPjEdzgRoN3k";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-28a14a3989973cffb8ca.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-8b8f96708869c0da666c.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-e32bf5f6d150edd53e26.js"],"component---src-pages-index-js":["/component---src-pages-index-js-1b9f26b1b7aca2259700.js"],"pages-manifest":["/pages-manifest-91bbe630295242f99d90.js"]};/*]]>*/</script><script src="/blogs/component---src-templates-blog-post-js-e32bf5f6d150edd53e26.js" async=""></script><script src="/blogs/styles-593a6e91d2f8e7c9e0e3.js" async=""></script><script src="/blogs/app-28a14a3989973cffb8ca.js" async=""></script><script src="/blogs/webpack-runtime-60b6eddc7b2f69aba7f0.js" async=""></script><script>
            const DARK = 'dark';
            const LIGHT = 'light';
            if (typeof localStorage !== 'undefined') {
              const theme = localStorage.getItem('theme');
              window.__preferTheme = theme;
              document.body.className = theme;
            }
          </script></body></html>