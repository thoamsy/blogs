{"data":{"site":{"siteMetadata":{"title":"ğŸ˜","author":"Yang Kui"}},"markdownRemark":{"id":"f88bfc8d-dd22-5374-b086-ca0f37647437","html":"<h2 id=\"èƒŒæ™¯\"><a href=\"#%E8%83%8C%E6%99%AF\" aria-label=\"èƒŒæ™¯ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>èƒŒæ™¯</h2>\n<p>ä»å¼€å§‹æ¥è§¦å¼‚æ­¥è¯·æ±‚ï¼Œæ¥è§¦ AJAX å’Œ Promise åï¼Œå°±ä¼šå‘ç°è¿™äº›æ“ä½œå¾ˆ<strong>ã€Œå¥—è·¯åŒ–ã€</strong>ã€‚ç»å¤§å¤šæ•°çš„å¼‚æ­¥æ“ä½œä¼¼ä¹éƒ½å¯ä»¥ç±»ä¼¼ä¸‹é¢ ğŸ‘‡ çš„ä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> rep <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>rep<span class=\"token punctuation\">.</span>data <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ç”Ÿæ´»å¾ˆç¾å¥½å§ï¼Œumhï¼Ÿä¸è¿‡å‘¢ï¼Œè¿™è®©æ•´ä¸ªäº¤äº’ä½“éªŒå˜å¾—ä¸é‚£ä¹ˆã€Œäººæ€§åŒ–ã€äº†ã€‚å› ä¸ºä¸è®ºä»»ä½•æ—¶å€™ï¼Œç½‘é€Ÿæ€ä¹ˆæ ·ï¼Œéƒ½ä¼šå…ˆç”Ÿç¡¬åœ°åŠ è½½ä¸€ä¸ª loading UIï¼Œç„¶ååœ¨æ¥å£è¿”å›çš„æ—¶å€™ï¼Œ<strong>åŒ†åŒ†å®Œäº‹</strong>ã€‚</p>\n<p>å¦‚æœ loading UI ä¾µå…¥æ€§æ¯”è¾ƒå°çš„è¯ï¼Œå¯èƒ½ä¸æ˜¯é‚£ä¹ˆè®©äººè®¨åŒï¼Œä½†æƒ³è±¡ä¸€ä¸ªå…¨å±å¹•çš„ loadingï¼šå®ƒå”°åœ°å‡ºç°äº†ä¸€ä¸‹å­åˆæ¶ˆå¤±äº†ã€‚ä½ è¿™ä¸ªæ—¶å€™å°±ä¸ä¼šè§‰å¾—è¿™æ˜¯å¾ˆå¥½çš„ç”¨æˆ·ä½“éªŒäº†ï¼Œåè€Œè§‰å¾—å¾ˆè ¢ã€‚</p>\n<p>æ‰€ä»¥æ€»ç»“ä¸¤ç‚¹ï¼Œä¸åˆ†é’çº¢çš‚ç™½å°± loadingï¼Œåœ¨é«˜é€Ÿç½‘ç»œä¸‹å¸¦æ¥çš„é—®é¢˜</p>\n<ol>\n<li>å‡ºç° loadingï¼Œä¼šè®©ç”¨æˆ·è§‰å¾—å˜å¡äº†ï¼ˆè®¾æƒ³ä¸€ä¸‹æ¯æ¬¡å¾®ä¿¡èŠå¤©ç•Œé¢éƒ½æœ‰ä¸€ä¸ª loadingï¼‰</li>\n<li>é—ªçƒçš„ä½“éªŒè®©äººå¾ˆåˆ†è£‚</li>\n</ol>\n<h2 id=\"promise-çš„è§£å†³æ–¹æ¡ˆ\"><a href=\"#promise-%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88\" aria-label=\"promise çš„è§£å†³æ–¹æ¡ˆ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Promise çš„è§£å†³æ–¹æ¡ˆ</h2>\n<p>ä½ å¯ä»¥ä¸ç”¨è¯»å®Œï¼Œç›´æ¥çœ‹<a href=\"https://codesandbox.io/s/kxzxnnj8vr\">å®Œæˆä»£ç </a>å°±è¡Œäº†</p>\n<p>ä¸»è¦çš„å®ç°æ€è·¯å°±æ˜¯é€šè¿‡åœ¨<strong>è¯·æ±‚å’Œè¶…æ—¶</strong>ä¸­ç«äº‰å‡ºä¼˜å…ˆè¢« settled çš„é‚£ä¸ª Promiseï¼Œä½œå‡ºç›¸åº”çš„é€»è¾‘ã€‚\nä¸ºäº†å®ç°çš„ç®€å•ï¼Œè¶…æ—¶çš„å‡½æ•°å¯ä»¥å†™æˆ</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">timeout</span> <span class=\"token operator\">=</span> ms <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>reject<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>timeout çš„å®ç°ä½¿ç”¨ reject è€Œä¸æ˜¯ resolve å¯ä»¥è®©ä»£ç æ›´åŠ ç®€æ´ã€‚å› ä¸ºè¿›å…¥ <em>fulfilled</em> çš„æƒ…å†µåªæœ‰ä¸€ç§ï¼Œå°±æ˜¯åœ¨ ms ä¹‹å†…è¯·æœåŠ¡å™¨å“åº”å¹¶è¿”å›äº†ã€‚è€Œåœ¨ rejected çŠ¶æ€ä¸‹ï¼Œå°±æ˜¯è¶…æ—¶çš„é€»è¾‘ï¼ˆ<strong>æ³¨æ„ âš ï¸ï¼Œè¿™é‡Œä¸è€ƒè™‘è¯·æ±‚å¼‚å¸¸çš„æƒ…å†µ</strong>ï¼‰</p>\n<p>æ ¹æ®ä¸Šé¢çš„è¯´æ³•ï¼Œå¾ˆå®¹æ˜“å†™å‡ºä¸€ä¸ª naive çš„å®ç°</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rep <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>rep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¾ˆæ˜¾ç„¶ï¼Œè¿™ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚å¦‚æœæ²¡æœ‰è¿›å…¥ <code class=\"language-text\">catch</code> é‡Œï¼Œä¸–ç•Œå’Œå¹³ï¼Œä½†æ˜¯å¦‚æœè¿›å…¥ <code class=\"language-text\">catch</code> é‡Œï¼Œè°å¸®æˆ‘ä»¬ç»§ç»­å¤„ç†è¿”å›çš„æ•°æ®å‘¢ï¼Ÿæ¢å¥è¯è¯´ï¼Œå®ƒåªæŠŠä¸€ä¸ª loading ä¸¢ç»™ä½ ï¼Œå…¶ä»–å°±ä¸ç®¡äº†ï¼</p>\n<p>æ¥ç€ï¼Œæˆ‘ä»¬æ”¹è¿›ä¸€ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> rep <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>rep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rep <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>rep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å—¯ï¼Œçœ‹ä¸Šå»è§£å†³äº†ä¸Šé¢çš„é—®é¢˜ã€‚ä¸è¿‡å®ƒè§£å†³é—®é¢˜çš„æ–¹æ³•æ˜¯é€šè¿‡ <strong>å†å‘ä¸€æ¬¡è¯·æ±‚</strong>ï¼Œç›¸å½“äºæ²¡æœ‰è§£å†³é—®é¢˜ã€‚\nä½†å…¶å®æˆ‘ä»¬å·²ç»æ¥è¿‘åˆ°é‚£éš§é“å°½å¤´çš„å…‰äº†ã€‚</p>\n<p>å¦‚æœ <code class=\"language-text\">const rep = await fetch(url)</code> è¿™å¥è¯ä¸ä¼šé‡æ–°å‘é€è¯·æ±‚ï¼Œè€Œä»…ä»…åªæ˜¯æ¥ç€ç¬¬ä¸€æ¬¡è°ƒç”¨ <code class=\"language-text\">fetch(url)</code> çš„åœºæ™¯ï¼Œæ‰¿è½½ç€é‚£ä¸ª Promiseï¼Œæ˜¯ä¸æ˜¯å°±è§£å†³æˆ‘ä»¬çš„é—®é¢˜äº†ï¼Ÿ</p>\n<p>æ˜¯çš„ï¼Œæˆ‘ä»¬åªéœ€è¦å°† <code class=\"language-text\">fetch(url)</code> ä¿å­˜ä¸‹æ¥ï¼Œå°±å¯ä»¥åšåˆ°äº†ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">let</span> fetchPromise <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n  fetchPromise <span class=\"token operator\">=</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rep <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> fetchPromise<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>rep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> rep <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> fetchPromise<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>rep<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Itâ€™s Done ğŸ˜.</p>\n<h2 id=\"è®©å®ƒæ›´åŠ é€šç”¨\"><a href=\"#%E8%AE%A9%E5%AE%83%E6%9B%B4%E5%8A%A0%E9%80%9A%E7%94%A8\" aria-label=\"è®©å®ƒæ›´åŠ é€šç”¨ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>è®©å®ƒæ›´åŠ é€šç”¨</h2>\n<p>æ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯è®©è¿™ä¸ªåœºæ™¯æ›´åŠ é€šç”¨ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ª<strong>é«˜é˜¶å‡½æ•°</strong>ï¼ŒæŠŠæ™®é€šçš„å¼‚æ­¥å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ”¯æŒè¯¥ç‰¹æ€§çš„å‡½æ•°ã€‚</p>\n<p>æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªæœ€ç¬¦åˆç›´è§‰çš„å‡½æ•°ï¼Œå®ƒéœ€è¦å“ªäº›å‚æ•°ï¼š</p>\n<ol>\n<li>å¼‚æ­¥å‡½æ•°</li>\n<li>è¶…æ—¶æ—¶é—´</li>\n<li>æ¥å£è¿”å›åçš„å›è°ƒ</li>\n<li>è¶…æ—¶çš„å›è°ƒ</li>\n</ol>\n<p>ä¸‹é¢ä½¿ç”¨ Promise è€Œä¸æ˜¯ <code class=\"language-text\">async</code> æ¥å®ç°ï¼Œå› ä¸ºè¿™æ ·ä¼šè®©ä»£ç æ›´ç®€å•ã€‚å®ç°å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">timeout</span> <span class=\"token operator\">=</span> ms <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ajax</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">,</span> resolve<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token function\">api</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Promise<span class=\"token punctuation\">.</span><span class=\"token function\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>request<span class=\"token punctuation\">,</span> <span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>resolve<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>è¿™æ ·å·²ç»èƒ½æ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„æ•ˆæœäº†ï¼Œä½†æ˜¯ä¸€ä¸ªå‡½æ•°ä»‹ç»å››ä¸ªå‚æ•°çš„è¯ï¼Œæœªå…æœ‰ç‚¹å¤šï¼Œè®©äººè§‰å¾—ä¸å¤ªè‡ªç„¶ã€‚\né€šè¿‡è§‚å¯Ÿç¬¬ 5 è¡Œå’Œç¬¬ 7 è¡Œï¼Œæˆ‘ä»¬å‘ç° <code class=\"language-text\">request</code> åä¸‹ä¸€ä¸ª fulfilled å›è°ƒæ˜¯ <code class=\"language-text\">resolve</code>ï¼Œ<code class=\"language-text\">timeout</code> åœ¨è§£å†³å®Œ <code class=\"language-text\">reject</code> åä¸‹ä¸€ä¸ª <code class=\"language-text\">fulfilled</code> å›è°ƒä¹Ÿæ˜¯ <code class=\"language-text\">resolve</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å°†ä»£ç æ”¹æˆè¿™æ · <code class=\"language-text\">ajax(api, ms, reject).then(resolve)</code>ã€‚</p>\n<p>çœ‹ä¸‹æ”¹è¿›åçš„ä»£ç ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">timeout</span> <span class=\"token operator\">=</span> ms <span class=\"token operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ajax</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>api<span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> request <span class=\"token operator\">=</span> <span class=\"token function\">api</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">race</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>request<span class=\"token punctuation\">,</span> <span class=\"token function\">timeout</span><span class=\"token punctuation\">(</span>ms<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>undefined<span class=\"token punctuation\">,</span> err <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>è¿™é‡Œä»£ç å’Œ ğŸ‘† çš„åŒºåˆ«ä¸»è¦æ˜¯ç¬¬äº”è¡Œä¸­çš„ thenï¼Œä¸å†æ˜¯ resolveï¼Œè€Œæ˜¯ undefinedã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ\nçœ‹ä¸‹ MDN ä¸­ï¼Œå…³äº <code class=\"language-text\">Promise.then</code> çš„ä¸€ä¸ªç‰¹åˆ«çš„å®šä¹‰ã€‚</p>\n<blockquote>\n<p>If one or both arguments are omitted or are provided non-functions, thenÂ thenÂ will be missing the handler(s), but will not generate any errors. If the Promise that then is called on adopts a state (fulfillment or rejection) for whichÂ then has no handler,Â a new Promise is created with no additional handlers, simply adopting the final state of the original Promise on which then was called.</p>\n</blockquote>\n<p>ç¿»è¯‘è¿‡æ¥å…¶å®å°±æ˜¯ï¼Œå¦‚æœ then é‡Œçš„ä¸¤ä¸ªå‚æ•°æœ‰ä¸€ä¸ªå‡½æ•°æ²¡æœ‰å£°æ˜çš„è¯ï¼Œå°±ä¼šç›´æ¥è¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œå¹¶æŠ›å‡ºå»ã€‚è™½ç„¶çœ‹ä¸Šå»å¾ˆéš¾ç†è§£ï¼Œå…¶å®ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„ <code class=\"language-text\">catch</code> ä¸å°±æ˜¯ <code class=\"language-text\">then(undefined, reject)</code> çš„è¯­æ³•ç³–ï¼Ÿæœ€åå¯ä»¥æ”¹æˆ</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">const ajax = (api, ms, reject) =&gt; (...args) =&gt; {\n  const request = api(...args);\n  return Promise.race([request, timeout(ms)]).catch(err =&gt; {\n    reject(err);\n    return request;\n  });\n};</code></pre></div>\n<h2 id=\"æœªè§£å†³é—®é¢˜\"><a href=\"#%E6%9C%AA%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98\" aria-label=\"æœªè§£å†³é—®é¢˜ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æœªè§£å†³é—®é¢˜</h2>\n<p>åœ¨æ•´ä¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å¿½ç•¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ request ä¹Ÿæœ‰ <strong>throw å¼‚å¸¸</strong> çš„æƒ…å†µï¼Œä¸€ä¸ªå…³é”®çš„é—®é¢˜å°±éœ€è¦åœ¨ catch ä¸­åŒºåˆ†åˆ°åº•æ˜¯è¶…æ—¶è¿˜æ˜¯æœåŠ¡å™¨å¼‚å¸¸å¯¼è‡´çš„é—®é¢˜ã€‚è€Œä¸ºäº†åŒºåˆ†è¿™ä¸ªï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯ Symbolã€‚</p>\n<p>å› ä¸ºå®ƒæ˜¯<strong>å”¯ä¸€</strong>çš„ã€‚ä¸‹é¢ä¸ºäº†ä»£ç çš„æ¸…æ™°ï¼Œæˆ‘æ”¹æˆäº† <code class=\"language-text\">Symbol.for</code>ã€‚\nå¯ä»¥å°† <code class=\"language-text\">timeout</code> æ”¹ä¸ºï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">timeout</span> <span class=\"token operator\">=</span> ms <span class=\"token operator\">=></span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>_<span class=\"token punctuation\">,</span> reject<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>Symbol<span class=\"token punctuation\">.</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token string\">'timeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> ms<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>æ¥ç€æˆ‘ä»¬åœ¨ catch çš„æ—¶å€™åšä¸€ä¸ªåˆ¤æ–­ï¼Œå°†æœåŠ¡ç«¯å¼‚å¸¸çš„é€ æˆçš„é—®é¢˜æŠ›å‡ºå»</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">catch</span><span class=\"token punctuation\">(</span>err <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Symbol<span class=\"token punctuation\">.</span><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token string\">'timeout'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> request<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">throw</span> err<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"ç¾å¥½çš„æœªæ¥-\"><a href=\"#%E7%BE%8E%E5%A5%BD%E7%9A%84%E6%9C%AA%E6%9D%A5-\" aria-label=\"ç¾å¥½çš„æœªæ¥  permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç¾å¥½çš„æœªæ¥ âœ¨</h2>\n<p>React ç”¨æˆ·åº”è¯¥éƒ½çŸ¥é“ <code class=\"language-text\">Suspense</code>ï¼Œå¯æƒœçš„æ˜¯å®ƒç›®å‰çš„ç”¨å¤„ä»…ä»…æ˜¯<strong>Code Splitting</strong>ã€‚ä¼¼ä¹å› ä¸ºä¸€äº›ç¨³å®šæ€§é—®é¢˜ï¼ŒReact è¿˜æ²¡æœ‰å°†å®ƒæœ€å¼ºå¤§çš„ä¸€é¢å…¬å¸ƒå‡ºæ¥ã€‚å½“ç„¶è¿™æ˜¯åè¯ï¼Œä½†æ˜¯å¦‚æœä½ çœ‹è¿‡\n<a href=\"https://www.youtube.com/watch?v=ByBPyMBTzM0&#x26;t=1368s\">Concurrent Rendering in React - Andrew Clark and Brian Vaughn - React Conf 2018</a> æˆ–è€…è¿™ä¸ª <a href=\"https://github.com/facebook/react/tree/master/fixtures/unstable-async/suspense\">Demo</a> ï¼Œå°±çŸ¥é“ <code class=\"language-text\">ConcurrentMode</code> é…åˆ <code class=\"language-text\">Suspense</code> çš„ <code class=\"language-text\">maxDuration</code> å°±èƒ½è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚æ¯”å¦‚è¿™æ ·ä¸€ä¸ªåœºæ™¯</p>\n<blockquote>\n<p>æ‡’åŠ è½½è·¯ç”± A çš„ç»„ä»¶ï¼Œ500ms å†…æ²¡æœ‰åŠ è½½æˆåŠŸåˆ™æ˜¾ç¤º loading</p>\n</blockquote>\n<p>è¿™ä¸ªé€šè¿‡æœªæ¥çš„ React å¯ä»¥è½»æ¾åšåˆ°</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> LazyHome <span class=\"token operator\">=</span> <span class=\"token function\">lazy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./home'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ConcurrentMode</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      // çœå»ä¸€äº› Route ç›¸å…³ä»£ç \n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Route</span>\n        <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token attr-name\">render</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Suspense</span> <span class=\"token attr-name\">maxDuration</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">500</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>BeautifulLoading</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>LazyHome</span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">props</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Suspense</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ConcurrentMode</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>è¿™ä¸ªä¾‹å­å…¶å®å’Œæˆ‘ä»¬è¦è®¨è®ºçš„ä¸ä¸€æ ·ï¼Œä¸Šé¢çš„ä¾‹å­æ˜¯å…³äº Code Splittingï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºçš„æ˜¯ Ajax è¯·æ±‚çš„ã€‚</p>\n<p>ä¸è¿‡å¼ºå¤§çš„ React ä¹Ÿæœ‰æ–¹å¼åšåˆ°åè€…ï¼Œé€šè¿‡ <code class=\"language-text\">react-cache</code> é…åˆ <code class=\"language-text\">Suspense</code></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> createResource <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-cache'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> fakeResource <span class=\"token operator\">=</span> <span class=\"token function\">createResource</span><span class=\"token punctuation\">(</span>fakeAPI<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">List</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> fakeResource<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>item <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ConcurrentMode</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Suspense</span> <span class=\"token attr-name\">maxDuration</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token number\">500</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">fallback</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>BeautifulLoading</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>List</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Suspense</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ConcurrentMode</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>å®ƒå¯ä»¥åœ¨ 500ms ä¹‹å†…æ²¡æœ‰æ¥å—åˆ°æœåŠ¡å™¨å“åº”çš„è¯ï¼Œæ˜¾ç¤º loadingï¼Œå¦åˆ™ç›´æ¥æ¸²æŸ“ listã€‚</p>\n<p>æ ¹æ®<a href=\"https://reactjs.org/blog/2018/11/27/react-16-roadmap.html#tldr\">å®˜æ–¹çš„è¯´æ³•</a>ï¼Œç­‰åˆ° <code class=\"language-text\">ConcurrentMode</code> çš„ç¨³å®šï¼Œè‡³å°‘ä¹Ÿè¦åˆ° 2019 å¹´çš„ Q2ï¼Œè€Œå®¢æˆ·ç«¯çº§åˆ«çš„ <code class=\"language-text\">Suspense</code> è¦åˆ° Q3ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"æ€»ç»“ permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>æ€»ç»“</h2>\n<p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä½¿ç”¨ <code class=\"language-text\">Promise.race</code> æ¥è§£å†³ loading é—ªçƒçš„é—®é¢˜ã€‚åŒæ—¶ä¹Ÿæ­éœ²äº†æœªæ¥ React å¯ä»¥å¸¦æ¥çš„å£°æ˜å¼çš„å†™æ³•ï¼Œä»¥åŠå¦‚ä½•åœ¨ <code class=\"language-text\">Code Splitting</code> ä¸­è§£å†³åŒæ ·çš„é—®é¢˜ã€‚</p>","frontmatter":{"title":"è§£å†³ loading é—ªçƒçš„é—®é¢˜","spoiler":"æ— æ¡ä»¶ loading æ˜¯æœ‰ä»£ä»·çš„","date":"2019/01/12"}}},"pageContext":{"slug":"/solve-fresh-of-loading/solve the fresh of loading/","previous":{"fields":{"slug":"/react-trap/"},"frontmatter":{"title":"ä¸€äº› React ä¸­çš„åˆé’»é—®é¢˜","spoiler":"æ”¶é›†ä¸€äº›ä¸ä¸ºäººæ‰€çŸ¥çš„ï¼ŒReact çš„ç»†èŠ‚é—®é¢˜ã€‚å¸®åŠ©è‡ªå·±ç†é¡º React å†…éƒ¨æ·±å±‚çš„é€»è¾‘"}},"next":{"fields":{"slug":"/division100/division100/"},"frontmatter":{"title":"ä¸ºä»€ä¹ˆè¦é™¤ä»¥ 100?","spoiler":"ä¸€ä¸ªæ•´æ•°é™¤ä»¥ 100 å¾—åˆ°çš„æµ®ç‚¹æ•°ï¼Œæ˜¯å¦ä¼šä¸¢å¤±è¿›åº¦"}}}}