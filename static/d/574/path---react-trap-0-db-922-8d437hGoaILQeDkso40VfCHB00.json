{"data":{"site":{"siteMetadata":{"title":"ğŸ˜","author":"Yang Kui"}},"markdownRemark":{"id":"97c29bd3-aae1-529f-b4e0-dd02c5231703","html":"<p>æ”¶é›†ä¸€äº›ä¸ä¸ºäººæ‰€çŸ¥çš„ï¼ŒReact çš„ç»†èŠ‚é—®é¢˜ã€‚å¸®åŠ©è‡ªå·±ç†é¡º React å†…éƒ¨æ·±å±‚çš„é€»è¾‘ã€‚</p>\n<h1>Synthetic Event å’Œ DOM Event åŒæ—¶å‡ºç°çš„é—®é¢˜</h1>\n<p>é¦–å…ˆè§£é‡Šä¸‹ï¼Œä¸ºä»€ä¹ˆ React ä¼šæœ‰ Synthetic Event è¿™ä¸ªæ¦‚å¿µã€‚ä¸»è¦ä¸¤ä¸ªåŸå› </p>\n<ol>\n<li>13 å¹´çš„æ—¶å€™ï¼Œæµè§ˆå™¨å‘å±•æ¯”å¦‚ä»Šå¤©ï¼Œä¸åŒçš„æµè§ˆå™¨åœ¨åŒä¸€ä¸ªæ¦‚å¿µä¸Šï¼Œå¯èƒ½ä¼šæœ‰ä¸åŒçš„ APIï¼Œå¦å¤–é‚£ä¸ªæ—¶å€™è¿˜éœ€è¦å…¼å®¹ IE8ã€‚</li>\n<li>é’ˆå¯¹å¤§é‡åˆ›å»º Event Object çš„åœºæ™¯ï¼Œæœ‰ä¸€ä¸ªä¼˜åŒ–ã€‚è¿™å°±è¯ç”Ÿäº† Event Pooling è¿™ä¸ªæ¦‚å¿µã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ React ä¸­ä¸éœ€è¦ä¹‹å‰çš„<strong>äº‹ä»¶å§”æ‰˜</strong></li>\n</ol>\n<p>è€Œ React ä¸ºäº†å®ç° Synthetic Eventï¼Œæ˜¯é€šè¿‡å°†æ‰€æœ‰çš„ <code class=\"language-text\">onXXX</code> äº‹ä»¶æ³¨å†Œåœ¨ <code class=\"language-text\">document</code> ä¸Šæ¥å®ç°çš„ã€‚æ‰€ä»¥è¿™å°±åœ¨æŸäº›ååˆ†ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼Œä¼šäº§ç”Ÿä¸€äº›é—®é¢˜ã€‚çœ‹ä¸‹é¢ä»£ç ï¼Œæˆ–è€… <a href=\"https://codesandbox.io/s/v1m3o069j7\">sandbox</a></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useCallback<span class=\"token punctuation\">,</span> useEffect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> handleClickOnDocument <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on document'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> handleClickOnWindow <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on window'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> handleClickDiv <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on div with ref'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnDocument<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnDocument<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n        <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          e<span class=\"token punctuation\">.</span><span class=\"token function\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        Click Me\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>å¦‚æœç‚¹å‡»é‚£ä¸ª button ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåœ¨ä¼ ç»Ÿçš„ DOM ä»£ç ä¸­ï¼Œå¾ˆæ˜æ˜¾ä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡ºã€‚ä½†æ˜¯åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">handling event on the document</code></pre></div>\n<p>ä¸€èµ·æ¥åˆ†æä¸‹åŸå› </p>\n<h2>åŸå› </h2>\n<p>é¦–å…ˆï¼Œåœ¨ button è¢«ç‚¹å‡»åï¼Œ<code class=\"language-text\">stopPropagation</code> èµ·ä½œç”¨ï¼Œä½¿çˆ¶ç»„ä»¶ div çš„ <em>onClick</em> Synthetic Event ä¸ä¼šè¢«è°ƒç”¨ã€‚å¦å¤–ï¼ŒåŸç”Ÿçš„ DOM äº‹ä»¶ä¹Ÿä¼šè¢«è§¦å‘ã€‚å› ä¸º stopPropagation ä¸åŒäº <code class=\"language-text\">stopImmediatePropagation</code>ï¼Œæ‰€ä»¥ document ä¸Šçš„äº‹ä»¶è¿˜æ˜¯è¢«è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œ<em>window</em> ä¸Šçš„äº‹ä»¶å°±ä¸ä¼šè¢«è°ƒç”¨ã€‚</p>\n<p>åŸå› å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ã€‚å¦‚æœåœ¨ div ä¸Šæœ‰ä¸€ä¸ª native DOM äº‹ä»¶ï¼Œé‚£ä¹ˆåœ¨<strong>ç‚¹å‡» button åï¼Œåˆ°åº•æ˜¯ button çš„ Synthetic äº‹ä»¶å…ˆè¿è¡Œè¿˜æ˜¯ button çš„ native äº‹ä»¶ï¼Ÿ</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useCallback<span class=\"token punctuation\">,</span> useEffect<span class=\"token punctuation\">,</span> useRef <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span></span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> handleClickOnDocument <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on document'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> handleClickOnWindow <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on window'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> handleClickDiv <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on div with ref'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> div <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnDocument<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">    div<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickDiv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      document<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnDocument<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickOnWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">      div<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> handleClickDiv<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>div<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'handling event on div'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span></span><span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span>\n        <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">          console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'button'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>          e<span class=\"token punctuation\">.</span><span class=\"token function\">stopPropagation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n      <span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        Click Me</span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>ç›´è§‰ä¸Šæ˜¯ä¼šè§‰å¾—æ˜¯ä¼šæ‰“å°å‡º</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">button\nhandle event on div with ref\nhandling event on the document</code></pre></div>\n<p>ä½†æ ¹æ®ä¸Šé¢çš„è¯´æ³•ï¼Œ Synthetic Event ä¼šç»‘å®šåœ¨ document ä¸Šï¼Œé‚£ä¹ˆæ ¹æ®<strong>å†’æ³¡</strong>çš„é¡ºåºï¼Œdiv çš„ native äº‹ä»¶ä¼šå…ˆè¿è¡Œã€‚å¯ä»¥å¾—å‡ºä¸‹é¢çŒœæµ‹</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">handling event on div with ref\nbutton\nhandling event on document</code></pre></div>\n<p>é‚£æœ€åçš„ç»“æœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¯ä»¥è‡ªå·±å»å°è¯•ä¸‹ã€‚</p>\n<h2>ç»“è®º</h2>\n<p>å› ä¸º Synthetic Event ä¼šå°†äº‹ä»¶ç»‘å®šåœ¨ document ä¸Šï¼Œä»è€Œå¯¼è‡´åœ¨å’Œ native dom äº‹ä»¶æœ‰ä¸€å®šé€»è¾‘å…³è”çš„æ—¶å€™ï¼Œå‡ºç°ä¸€äº›ä¸ç¬¦åˆç›´è§‰çš„é—®é¢˜ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸€å®šéœ€è¦å°å¿ƒã€‚</p>\n<h2>ç›¸å…³é“¾æ¥</h2>\n<ul>\n<li><a href=\"https://github.com/facebook/react/issues/12518\">Event listener attached to document will still be called after calling event.stopPropagation() Â· Issue #12518 Â· facebook/react Â· GitHub</a></li>\n<li><a href=\"https://reactjs.org/docs/events.html\">SyntheticEvent â€“ React</a></li>\n</ul>\n<hr>\n<h1>Context çš„æ›´æ–°ï¼Œä¼šæ›´æ–° âœ¨ Provider â¡ï¸ Consumer ä¹‹é—´æ‰€æœ‰çš„ç»„ä»¶ä¹ˆ</h1>\n<p>è¿™ä¸ªé—®é¢˜æå‡ºæ¥çš„ä¾æ®ä¸»è¦æ˜¯ï¼Œ<code class=\"language-text\">setState</code> åœ¨ React ä¸­æ˜¯ä¼š<strong>ä¸€å®šä¼šå¸¦æ¥æ›´æ–°çš„</strong>ï¼Œé™¤éè®¾ç½®äº† <code class=\"language-text\">memo</code> æˆ–è€… <code class=\"language-text\">shouldComponentUpdate</code> è¿™äº›ä¼˜åŒ–æªæ–½ã€‚æ¢å¥è¯è¯´ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯æ¬¡ Context ä¸­ value çš„æ›´æ–°ï¼Œå¿…å®šä¼´éšç€ä¸€ä¸ª setState çš„è¿‡ç¨‹ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹å¿…å®šå¯¼è‡´å«æœ‰ <code class=\"language-text\">&lt;Context.Provider&gt;</code> çš„ç»„ä»¶å¾€ä¸‹æ›´æ–°ï¼Œä¹Ÿå°±è®©æˆ‘ä»¬æ— æ³•è§‚å¯Ÿåˆ°è¿™ä¸ªè¿‡ç¨‹çš„æ›´è¿›ä¸€æ­¥çš„ç»†èŠ‚ã€‚</p>\n<p>å¦‚æœæƒ³è¦æ¢ç©¶è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œéœ€è¦ä¸‰ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«è¢«ç§°ä¸º App, Foo, Barã€‚\nApp å°±æ˜¯çˆ¶ç»„ä»¶ï¼Œå®ƒçš„ <code class=\"language-text\">render</code> ä¸­å°±è¿”å›äº†åŒ…å« Provider çš„ä»£ç ã€‚\nFoo ç»„ä»¶è¿™æ˜¯è¿™ä¸ª Context çš„æ¶ˆè´¹è€…ï¼Œå®ƒé€šè¿‡ Provider æ‹¿åˆ°å¯¹åº”çš„å±•ç¤ºå†…å®¹ã€‚\nBar åˆ™æ˜¯ä¸¤ä¸ªç»„ä»¶ä¸­çš„ä¸­é—´å±‚ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æ‰¿æ¥ Foo å’Œ Appã€‚åŒæ—¶å®ƒçš„ <code class=\"language-text\">shouldComponentUpdate</code> ä¼šè®¾ç½®ä¸º <strong>false</strong>ã€‚</p>\n<p>å€ŸåŠ© Hooksï¼Œæœ‰ä¸‹é¢çš„å®éªŒ ğŸ§ª ä»£ç ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useContext<span class=\"token punctuation\">,</span> memo<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> useCallback <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> FooContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Foo</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>FooContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token string\">'foo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">i am </span><span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> Bar <span class=\"token operator\">=</span> <span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span></span>  console<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Foo</span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>value<span class=\"token punctuation\">,</span> setValue<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> addValue <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setValue</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">This is a context test</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>addValue<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">click me!!!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>FooContext.Provider</span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Bar</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>FooContext.Provider</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\"></span>\n<span class=\"token plain-text\">    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ç•Œé¢å¾ˆ ç®€å•\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blogs/static/54994c1a9ee04a660dadf84f9d566906/96ec6/FABCB7EA-DB45-4A07-B5D7-AFDB521F6219.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 800px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.449541284403665%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAApElEQVQoz62QzQqFIBCFff93aRtKRaQlam1c+BKFi9ZWJ65gRNSF+zNwkDkcvxkl+LK2bbv1SZZlaNsWxhhYa+Gcg9YaZVkiz3N0XQchBDjnaJoGVVXBe/8IJa9AXdfo+x5SSgzDEE/GWLxcFAWUUnEgpTT28zw/A//+5GmaMI4jQghY1/XQsiyHrl6C3W6Y1k+Bs+68d7AIPH/wU+iTItdpv0J3pjVpSjxQAyIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"FABCB7EA DB45 4A07 B5D7 AFDB521F6219\"\n        title=\"\"\n        src=\"/blogs/static/54994c1a9ee04a660dadf84f9d566906/42603/FABCB7EA-DB45-4A07-B5D7-AFDB521F6219.png\"\n        srcset=\"/blogs/static/54994c1a9ee04a660dadf84f9d566906/f931c/FABCB7EA-DB45-4A07-B5D7-AFDB521F6219.png 200w,\n/blogs/static/54994c1a9ee04a660dadf84f9d566906/e8031/FABCB7EA-DB45-4A07-B5D7-AFDB521F6219.png 400w,\n/blogs/static/54994c1a9ee04a660dadf84f9d566906/42603/FABCB7EA-DB45-4A07-B5D7-AFDB521F6219.png 800w,\n/blogs/static/54994c1a9ee04a660dadf84f9d566906/96ec6/FABCB7EA-DB45-4A07-B5D7-AFDB521F6219.png 872w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n      />\n  </span>\n  </a>\né€šè¿‡ç‚¹å‡» <em>click me</em> é‚£ä¸ª buttonï¼Œå°±èƒ½çœ‹åˆ° /i am / çš„å˜åŒ–ã€‚åŒæ—¶æ³¨æ„ Foo å’Œ Bar ä¸­éƒ½æœ‰ä¸€ä¸ª <code class=\"language-text\">console.count</code> ç”¨æ¥è§‚å¯Ÿè¿™ä¸ªç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“ã€‚\næœ€åå¾—åˆ°çš„ç»“æœå°±æ˜¯ï¼Œ<strong>foo ä¼šéšç„¶æ¯æ¬¡ç‚¹å‡»éƒ½æ‰“å°ï¼Œè€Œ bar ä¸ä¼š</strong>ã€‚è€Œå¦‚æœå°† memo ç§»é™¤çš„è¯ï¼Œæ¯æ¬¡ bar ä¹Ÿä¼šè¢«æ‰“å°å‡ºæ¥äº†ã€‚</p>\n<p>æœ€åç»“è®ºå°±æ˜¯ï¼š<strong>Provider çš„æ›´æ–°ä¸ä¼šå¸¦åŠ¨ Consumer ä¹‹é—´çš„ç»„ä»¶æ›´æ–°</strong>ã€‚</p>\n<h2>éšä¾¿ä¸€æ</h2>\n<p>å½“ç„¶ï¼Œå…¶å®è¿™ä¸ªé—®é¢˜é€šè¿‡æ¨æ–­å°±èƒ½å¾—åˆ°ç»“æœçš„ã€‚å› ä¸ºæ–°çš„ Context å¸¦æ¥çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§å°±æ˜¯<strong>å³ä½¿ shouldComponentUpdate è¿”å› falseï¼Œå­ç»„ä»¶ä¹Ÿä¼šè¢«æ›´æ–°ã€‚</strong></p>\n<p>å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢çš„ Foo å’Œ Bar åˆæˆä¸€ä¸ª</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> Bar <span class=\"token operator\">=</span> <span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bar'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> foo <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>FooContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">i am </span><span class=\"token punctuation\">{</span>foo<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span></span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</p>","frontmatter":{"title":"ä¸€äº› React ä¸­çš„åˆé’»é—®é¢˜","spoiler":"æ”¶é›†ä¸€äº›ä¸ä¸ºäººæ‰€çŸ¥çš„ï¼ŒReact çš„ç»†èŠ‚é—®é¢˜ã€‚å¸®åŠ©è‡ªå·±ç†é¡º React å†…éƒ¨æ·±å±‚çš„é€»è¾‘","date":"2019/01/02"}}},"pageContext":{"slug":"/react-trap/","previous":{"fields":{"slug":"/react-lazy/"},"frontmatter":{"title":"React Lazy çš„å®ç°åŸç†","spoiler":"ç®€å•è®¨è®ºä¸€ä¸‹ React.lazy å†…éƒ¨å®ç°"}},"next":null}}